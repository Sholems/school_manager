module.exports=[15553,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68515),e=a.i(49679),f=a.i(15618),g=a.i(71931),h=a.i(81560),i=a.i(46842),j=a.i(87532),k=a.i(4720),l=a.i(3130),m=a.i(40695),n=a.i(87682),o=a.i(97895);let p=({students:a,classes:d,fees:e,payments:p,settings:q,selectedClass:r,setSelectedClass:s,selectedStudent:t,setSelectedStudent:u,onRecordPayment:v,onPrintReceipt:w,onDeletePayment:x,onPrintInvoice:y})=>{let[z,A]=(0,c.useState)(""),B=a.filter(a=>a.class_id===r),C=z?B.filter(a=>a.names.toLowerCase().includes(z.toLowerCase())||a.student_no.toLowerCase().includes(z.toLowerCase())):B,D=a.find(a=>a.id===t),E=t?p.filter(a=>a.student_id===t&&a.session===q.current_session&&a.term===q.current_term):[],F=D?e.filter(a=>a.session===q.current_session&&a.term===q.current_term&&(null===a.class_id||a.class_id===D.class_id)):[],{totalBill:G,totalPaid:H,balance:I}=D?o.getStudentBalance(D,e,p,q.current_session,q.current_term):{totalBill:0,totalPaid:0,balance:0};return(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-1 space-y-4",children:(0,b.jsxs)(l.Card,{className:"h-full",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)(n.Select,{label:"Select Class",value:r,onChange:a=>s(a.target.value),children:d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})}),(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Search student...",value:z,onChange:a=>A(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]})}),(0,b.jsxs)("div",{className:"space-y-1 max-h-[300px] lg:h-[550px] overflow-y-auto",children:[C.map(a=>{let c=o.getStudentBalance(a,e,p,q.current_session,q.current_term).balance;return(0,b.jsxs)("div",{onClick:()=>u(a.id),className:`p-2 lg:p-3 rounded-md cursor-pointer flex justify-between items-center text-sm transition-colors ${t===a.id?"bg-brand-50 border-brand-200 border":"hover:bg-gray-50"}`,children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("div",{className:"font-medium truncate",children:a.names}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.student_no})]}),(0,b.jsx)("div",{className:`font-mono text-xs lg:text-sm shrink-0 ml-2 ${c>0?"text-red-600":"text-green-600"}`,children:c>0?`-${o.formatCurrency(c)}`:"âœ“"})]},a.id)}),0===C.length&&(0,b.jsx)("div",{className:"text-center py-8 text-gray-400 text-sm",children:z?"No students match your search":"No students in this class"})]})]})}),(0,b.jsx)("div",{className:"lg:col-span-2",children:t&&D?(0,b.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 lg:gap-4",children:[(0,b.jsxs)(l.Card,{className:"bg-blue-50 border-blue-100 p-3 lg:p-4",children:[(0,b.jsx)("div",{className:"text-xs lg:text-sm text-blue-600",children:"Total Bill"}),(0,b.jsx)("div",{className:"text-base lg:text-xl font-bold text-blue-900",children:o.formatCurrency(G)})]}),(0,b.jsxs)(l.Card,{className:"bg-green-50 border-green-100 p-3 lg:p-4",children:[(0,b.jsx)("div",{className:"text-xs lg:text-sm text-green-600",children:"Total Paid"}),(0,b.jsx)("div",{className:"text-base lg:text-xl font-bold text-green-900",children:o.formatCurrency(H)})]}),(0,b.jsxs)(l.Card,{className:`p-3 lg:p-4 ${I>0?"bg-red-50 border-red-100":"bg-green-50 border-green-100"}`,children:[(0,b.jsx)("div",{className:`text-xs lg:text-sm ${I>0?"text-red-600":"text-green-600"}`,children:I>0?"Outstanding":"Status"}),(0,b.jsx)("div",{className:`text-base lg:text-xl font-bold ${I>0?"text-red-900":"text-green-900"}`,children:I>0?o.formatCurrency(I):"âœ“ Paid"})]})]}),(0,b.jsx)(l.Card,{title:"Bill Breakdown",action:y&&(0,b.jsxs)(m.Button,{size:"sm",variant:"secondary",onClick:()=>y(D),children:[(0,b.jsx)(k.FileText,{className:"h-4 w-4 mr-1 lg:mr-2"})," ",(0,b.jsx)("span",{className:"hidden sm:inline",children:"Print"})," Invoice"]}),children:(0,b.jsx)("div",{className:"overflow-x-auto -mx-4 lg:mx-0",children:(0,b.jsxs)("table",{className:"w-full text-xs lg:text-sm text-left min-w-[280px]",children:[(0,b.jsx)("thead",{className:"bg-gray-50 text-gray-700",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-3 lg:px-4 py-2",children:"Fee Head"}),(0,b.jsx)("th",{className:"px-3 lg:px-4 py-2 text-right",children:"Amount"})]})}),(0,b.jsxs)("tbody",{className:"divide-y divide-gray-100",children:[F.map(a=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"px-3 lg:px-4 py-2",children:a.name}),(0,b.jsx)("td",{className:"px-3 lg:px-4 py-2 text-right font-mono",children:o.formatCurrency(a.amount)})]},a.id)),(0,b.jsxs)("tr",{className:"bg-gray-50 font-bold",children:[(0,b.jsx)("td",{className:"px-3 lg:px-4 py-2",children:"Total Billed"}),(0,b.jsx)("td",{className:"px-3 lg:px-4 py-2 text-right",children:o.formatCurrency(G)})]})]})]})})}),(0,b.jsx)(l.Card,{title:"Payment History",action:(0,b.jsxs)(m.Button,{size:"sm",onClick:v,children:[(0,b.jsx)(f.Plus,{className:"h-4 w-4 mr-2"})," Record Payment"]}),children:(0,b.jsxs)("div",{className:"space-y-3 mt-2",children:[0===E.length&&(0,b.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No payments recorded for this term."}),E.map(a=>{let c=a.lineItems?.map(a=>a.purpose).join(", ")||"Payment";return(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded border border-gray-100",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:o.formatCurrency(a.amount)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[a.date," â€¢ ",a.method]}),(0,b.jsx)("div",{className:"text-xs text-brand-600 capitalize",children:c}),a.remark&&(0,b.jsxs)("div",{className:"text-xs text-gray-500 italic",children:['"',a.remark,'"']})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>w(a),title:"Print Receipt",className:"p-1 text-gray-400 hover:text-blue-600",children:(0,b.jsx)(g.Printer,{className:"h-4 w-4"})}),(0,b.jsx)("button",{onClick:()=>x(a.id),title:"Delete",className:"p-1 text-gray-400 hover:text-red-600",children:(0,b.jsx)(h.Trash2,{className:"h-4 w-4"})})]})]},a.id)})]})})]}):(0,b.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-200 rounded-lg p-12",children:[(0,b.jsx)(i.User,{className:"h-12 w-12 mb-4 opacity-50"}),(0,b.jsx)("p",{children:"Select a student to view fees and payments"})]})})]})};var q=a.i(41675);let r=({expenses:a,settings:d,onAddExpense:e,onDeleteExpense:g})=>{let[i,j]=(0,c.useState)("all"),[k,p]=(0,c.useState)("current"),r=[...a];"current"===k&&(r=r.filter(a=>a.session===d.current_session&&a.term===d.current_term)),"all"!==i&&(r=r.filter(a=>a.category===i)),r.sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime());let s=r.reduce((a,b)=>a+b.amount,0),t=r.reduce((a,b)=>(a[b.category]=(a[b.category]||0)+b.amount,a),{}),u=["salary","maintenance","supplies","utilities","other"],v={salary:"bg-blue-100 text-blue-700",maintenance:"bg-orange-100 text-orange-700",supplies:"bg-green-100 text-green-700",utilities:"bg-purple-100 text-purple-700",other:"bg-gray-100 text-gray-700"};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,b.jsxs)(l.Card,{className:"p-4 bg-red-50 border-red-100 col-span-2 md:col-span-1",children:[(0,b.jsx)("p",{className:"text-sm text-red-600",children:"Total Expenses"}),(0,b.jsx)("p",{className:"text-xl font-bold text-red-700",children:o.formatCurrency(s)}),(0,b.jsxs)("p",{className:"text-xs text-red-500",children:[r.length," records"]})]}),u.slice(0,4).map(a=>(0,b.jsxs)(l.Card,{className:"p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 capitalize",children:a}),(0,b.jsx)("p",{className:"text-lg font-bold text-gray-900",children:o.formatCurrency(t[a]||0)})]},a))]}),(0,b.jsx)(l.Card,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-end gap-4",children:[(0,b.jsx)("div",{className:"flex-1 min-w-[150px]",children:(0,b.jsxs)(n.Select,{label:"Category",value:i,onChange:a=>j(a.target.value),children:[(0,b.jsx)("option",{value:"all",children:"All Categories"}),u.map(a=>(0,b.jsx)("option",{value:a,className:"capitalize",children:a},a))]})}),(0,b.jsx)("div",{className:"flex-1 min-w-[150px]",children:(0,b.jsxs)(n.Select,{label:"Period",value:k,onChange:a=>p(a.target.value),children:[(0,b.jsx)("option",{value:"current",children:"Current Term"}),(0,b.jsx)("option",{value:"all",children:"All Time"})]})}),(0,b.jsxs)(m.Button,{onClick:e,children:[(0,b.jsx)(f.Plus,{className:"h-4 w-4 mr-2"})," Record Expense"]})]})}),(0,b.jsx)(l.Card,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,b.jsx)("thead",{className:"bg-gray-50 text-gray-700",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Date"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Title"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Category"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Session/Term"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3 w-16"})]})}),(0,b.jsxs)("tbody",{className:"divide-y divide-gray-100",children:[r.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Calendar,{className:"h-4 w-4 text-gray-400"}),a.date]})}),(0,b.jsxs)("td",{className:"px-4 py-3 font-medium text-gray-900",children:[a.title,a.description&&(0,b.jsx)("p",{className:"text-xs text-gray-500 font-normal",children:a.description})]}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs capitalize ${v[a.category]||v.other}`,children:a.category})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-gray-500 text-xs",children:[a.session," - ",a.term]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-right font-mono text-red-600 font-semibold",children:["-",o.formatCurrency(a.amount)]}),(0,b.jsx)("td",{className:"px-4 py-3",children:g&&(0,b.jsx)("button",{onClick:()=>g(a.id),className:"text-gray-400 hover:text-red-600 p-1",title:"Delete expense",children:(0,b.jsx)(h.Trash2,{className:"h-4 w-4"})})})]},a.id)),0===r.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"No expenses recorded for the selected filters."})})]}),r.length>0&&(0,b.jsx)("tfoot",{className:"bg-red-50",children:(0,b.jsxs)("tr",{className:"font-bold",children:[(0,b.jsx)("td",{colSpan:4,className:"px-4 py-3 text-right text-red-700",children:"TOTAL:"}),(0,b.jsxs)("td",{className:"px-4 py-3 text-right font-mono text-red-700",children:["-",o.formatCurrency(s)]}),(0,b.jsx)("td",{})]})})]})})})]})},s=({fees:a,classes:c,settings:d,onAddFeeHead:e,onDeleteFee:g})=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(m.Button,{onClick:e,children:[(0,b.jsx)(f.Plus,{className:"h-4 w-4 mr-2"})," Add Fee Head"]})}),(0,b.jsx)(l.Card,{title:"Current Session Fee Structure",children:(0,b.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,b.jsx)("thead",{className:"bg-gray-50 text-gray-700",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"Fee Name"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"Class Scope"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-100",children:a.filter(a=>a.session===d.current_session&&a.term===d.current_term).map(a=>{let d=a.class_id?c.find(b=>b.id===a.class_id)?.name:"All Classes";return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"px-4 py-3 font-medium",children:a.name}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:d})}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono",children:o.formatCurrency(a.amount)}),(0,b.jsx)("td",{className:"px-4 py-3 text-right",children:(0,b.jsx)("button",{onClick:()=>g(a.id),className:"text-gray-400 hover:text-red-600",children:(0,b.jsx)(h.Trash2,{className:"h-4 w-4"})})})]},a.id)})})]})})]});var t=a.i(32324),u=a.i(5522);let v={tuition:"Tuition Fees",registration:"Registration Fee",books:"Books & Materials",uniform:"School Uniform",transport:"Transport/Bus Fee",exam:"Examination Fee",excursion:"Excursion/Field Trip",other:"Other Payment"},w=({payment:a,student:c,cls:d,settings:e})=>{let f=a.lineItems?.length>0?a.lineItems:[{purpose:"payment",amount:a.amount}];return(0,b.jsxs)("div",{id:"receipt-print",children:[(0,b.jsx)("div",{style:{textAlign:"center",marginBottom:"12px",paddingBottom:"10px",borderBottom:"2px solid #1A3A5C"},children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[e.logo_media&&(0,b.jsx)("img",{src:e.logo_media,alt:"Logo",style:{height:"50px",width:"50px",objectFit:"contain"}}),(0,b.jsxs)("div",{style:{textAlign:"left"},children:[(0,b.jsx)("div",{style:{fontSize:"18px",fontWeight:800,color:"#1A3A5C",textTransform:"uppercase",lineHeight:1.2},children:e.school_name}),(0,b.jsxs)("div",{style:{color:"#555",fontSize:"10px",lineHeight:1.4},children:[e.school_address," | ",e.school_phone," | ",e.school_email]})]})]})}),(0,b.jsx)("div",{style:{background:"#1A3A5C",color:"white",textAlign:"center",padding:"6px",borderRadius:"4px",marginBottom:"12px"},children:(0,b.jsx)("h2",{style:{fontSize:"12px",letterSpacing:"2px",margin:0},children:"PAYMENT RECEIPT"})}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",marginBottom:"12px",fontSize:"11px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Receipt No:"})," ",(0,b.jsxs)("span",{style:{fontWeight:600,color:"#1A3A5C"},children:["#",a.id.substring(0,8).toUpperCase()]})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Date:"})," ",(0,b.jsx)("span",{style:{fontWeight:600,color:"#333"},children:a.date})]})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Session:"})," ",(0,b.jsx)("span",{style:{fontWeight:600,color:"#333"},children:a.session})]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Term:"})," ",(0,b.jsx)("span",{style:{fontWeight:600,color:"#333"},children:a.term})]})]})]}),(0,b.jsx)("div",{style:{background:"#f5f5f5",padding:"10px",borderRadius:"4px",marginBottom:"12px"},children:(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Received From"}),(0,b.jsx)("p",{style:{fontWeight:600,color:"#333",fontSize:"12px"},children:c.names}),(0,b.jsxs)("p",{style:{fontSize:"10px",color:"#666"},children:["ID: ",c.student_no]})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsx)("p",{style:{fontSize:"9px",color:"#888",textTransform:"uppercase"},children:"Class"}),(0,b.jsx)("p",{style:{fontWeight:600,color:"#333",fontSize:"12px"},children:d?.name||"N/A"})]})]})}),(0,b.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"12px"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{style:{background:"#f0f4f8",color:"#1A3A5C",padding:"8px",textAlign:"left",border:"1px solid #d9e2ec",fontSize:"11px"},children:"S/N"}),(0,b.jsx)("th",{style:{background:"#f0f4f8",color:"#1A3A5C",padding:"8px",textAlign:"left",border:"1px solid #d9e2ec",fontSize:"11px"},children:"Description"}),(0,b.jsx)("th",{style:{background:"#f0f4f8",color:"#1A3A5C",padding:"8px",textAlign:"right",border:"1px solid #d9e2ec",fontSize:"11px",width:"120px"},children:"Amount"})]})}),(0,b.jsxs)("tbody",{children:[f.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",fontSize:"11px",width:"40px",textAlign:"center"},children:c+1}),(0,b.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",fontSize:"11px"},children:v[a.purpose]||a.purpose}),(0,b.jsx)("td",{style:{padding:"8px",border:"1px solid #ddd",fontSize:"11px",textAlign:"right",fontWeight:600,color:"#1A3A5C"},children:o.formatCurrency(a.amount)})]},c)),(0,b.jsxs)("tr",{style:{background:"#f0f4f8"},children:[(0,b.jsxs)("td",{colSpan:2,style:{padding:"8px",border:"1px solid #d9e2ec",fontSize:"11px",fontWeight:700,textAlign:"right"},children:["TOTAL ",a.method&&(0,b.jsxs)("span",{style:{fontWeight:400,color:"#666"},children:["(via ",a.method.toUpperCase(),")"]})]}),(0,b.jsx)("td",{style:{padding:"8px",border:"1px solid #d9e2ec",fontSize:"13px",textAlign:"right",fontWeight:800,color:"#1A3A5C"},children:o.formatCurrency(a.amount)})]})]})]}),a.remark&&(0,b.jsxs)("div",{style:{fontSize:"10px",color:"#666",marginBottom:"12px",fontStyle:"italic"},children:["Note: ",a.remark]}),(0,b.jsxs)("div",{style:{borderTop:"2px solid #1A3A5C",paddingTop:"16px",marginTop:"20px",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsx)("div",{style:{width:"160px",borderBottom:"2px solid #333",height:"36px",marginBottom:"4px",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:e.head_of_school_signature&&(0,b.jsx)("img",{src:e.head_of_school_signature,alt:"Signature",style:{height:"32px",objectFit:"contain"}})}),(0,b.jsx)("p",{style:{fontWeight:600,fontSize:"11px"},children:e.head_of_school_name||"Head of School"}),(0,b.jsx)("p",{style:{fontSize:"9px",color:"#666"},children:e.head_teacher_label||"Head of School"})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsx)("p",{style:{color:"#8FC31F",fontStyle:"italic",fontSize:"12px"},children:e.school_tagline}),(0,b.jsxs)("span",{style:{fontSize:"9px",color:"#999"},children:["Â© ",new Date().getFullYear()," ",e.school_name]})]})]})]})},x=({student:a,cls:c,fees:d,payments:e,settings:f,discount:g=0,discountReason:h=""})=>{let{totalBill:i,totalPaid:j}=o.getStudentBalance(a,d,e,f.current_session,f.current_term),k=Math.max(0,Math.max(0,i-g)-j),l=d.filter(b=>b.session===f.current_session&&b.term===f.current_term&&(null===b.class_id||b.class_id===a.class_id)),m=e.filter(b=>b.student_id===a.id&&b.session===f.current_session&&b.term===f.current_term),n=new Date;n.setDate(n.getDate()+(f.invoice_due_days||14));let p=n.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),q=`INV-${f.current_session.replace("/","")}-${a.student_no.slice(-4)}-${Date.now().toString().slice(-6)}`;return(0,b.jsxs)("div",{id:"invoice-print",style:{fontFamily:"'Segoe UI', Arial, sans-serif",fontSize:"12px",color:"#333",background:"#fff",maxWidth:"800px",margin:"0 auto"},children:[(0,b.jsx)("div",{style:{borderBottom:"2px solid #1A3A5C",paddingBottom:"20px",marginBottom:"24px"},children:(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[f.logo_media&&(0,b.jsx)("img",{src:f.logo_media,alt:"Logo",style:{height:"70px",width:"70px",objectFit:"contain"}}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{style:{fontSize:"22px",fontWeight:700,color:"#1A3A5C",margin:0,textTransform:"uppercase"},children:f.school_name}),(0,b.jsx)("p",{style:{color:"#666",fontSize:"11px",margin:"4px 0 0 0"},children:f.school_address}),(0,b.jsxs)("p",{style:{color:"#666",fontSize:"11px",margin:"2px 0 0 0"},children:["Tel: ",f.school_phone," | Email: ",f.school_email]})]})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsx)("h2",{style:{fontSize:"28px",fontWeight:700,color:"#1A3A5C",margin:0},children:"INVOICE"}),(0,b.jsxs)("p",{style:{fontSize:"12px",color:"#666",margin:"4px 0 0 0"},children:["#",q]})]})]})}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[(0,b.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[a.passport_url?(0,b.jsx)("img",{src:a.passport_url,alt:a.names,style:{width:"60px",height:"60px",borderRadius:"4px",objectFit:"cover",border:"1px solid #ddd"}}):(0,b.jsx)("div",{style:{width:"60px",height:"60px",borderRadius:"4px",background:"#1A3A5C",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"20px",fontWeight:700},children:a.names.charAt(0)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{fontSize:"10px",color:"#888",textTransform:"uppercase",margin:0},children:"Bill To"}),(0,b.jsx)("p",{style:{fontSize:"16px",fontWeight:700,color:"#1A3A5C",margin:"2px 0",textTransform:"uppercase"},children:a.names}),(0,b.jsxs)("p",{style:{fontSize:"11px",color:"#555",margin:"2px 0"},children:["Student ID: ",a.student_no]}),(0,b.jsxs)("p",{style:{fontSize:"11px",color:"#555",margin:"2px 0"},children:["Class: ",c?.name||"N/A"]}),(0,b.jsxs)("p",{style:{fontSize:"11px",color:"#555",margin:"2px 0"},children:["Guardian: ",a.parent_name," (",a.parent_phone,")"]})]})]}),(0,b.jsx)("div",{style:{textAlign:"right"},children:(0,b.jsx)("table",{style:{fontSize:"11px",marginLeft:"auto"},children:(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"4px 12px 4px 0",color:"#666"},children:"Invoice Date:"}),(0,b.jsx)("td",{style:{padding:"4px 0",fontWeight:600},children:new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"4px 12px 4px 0",color:"#666"},children:"Due Date:"}),(0,b.jsx)("td",{style:{padding:"4px 0",fontWeight:600,color:"#DC2626"},children:p})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"4px 12px 4px 0",color:"#666"},children:"Session:"}),(0,b.jsx)("td",{style:{padding:"4px 0",fontWeight:600},children:f.current_session})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{style:{padding:"4px 12px 4px 0",color:"#666"},children:"Term:"}),(0,b.jsx)("td",{style:{padding:"4px 0",fontWeight:600},children:f.current_term})]})]})})})]}),(0,b.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"20px"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{background:"#1A3A5C"},children:[(0,b.jsx)("th",{style:{color:"white",padding:"12px",textAlign:"center",fontSize:"11px",fontWeight:600,width:"50px"},children:"S/N"}),(0,b.jsx)("th",{style:{color:"white",padding:"12px",textAlign:"left",fontSize:"11px",fontWeight:600},children:"Description"}),(0,b.jsx)("th",{style:{color:"white",padding:"12px",textAlign:"right",fontSize:"11px",fontWeight:600,width:"150px"},children:"Amount (â‚¦)"})]})}),(0,b.jsxs)("tbody",{children:[l.map((a,c)=>(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,b.jsx)("td",{style:{padding:"12px",textAlign:"center",fontSize:"11px",color:"#555"},children:c+1}),(0,b.jsx)("td",{style:{padding:"12px",fontSize:"12px",color:"#333"},children:a.name}),(0,b.jsx)("td",{style:{padding:"12px",textAlign:"right",fontSize:"12px",fontWeight:600,fontFamily:"monospace"},children:o.formatCurrency(a.amount).replace("â‚¦","")})]},a.id)),0===l.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:3,style:{padding:"20px",textAlign:"center",color:"#888",fontStyle:"italic"},children:"No fees available for this term"})})]})]}),(0,b.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"24px"},children:(0,b.jsx)("table",{style:{width:"280px",fontSize:"12px"},children:(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,b.jsx)("td",{style:{padding:"10px 0",color:"#666"},children:"Subtotal"}),(0,b.jsx)("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:600},children:o.formatCurrency(i)})]}),g>0&&(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,b.jsxs)("td",{style:{padding:"10px 0",color:"#059669"},children:["Discount ",h&&(0,b.jsxs)("span",{style:{fontSize:"10px"},children:["(",h,")"]})]}),(0,b.jsxs)("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:600,color:"#059669"},children:["-",o.formatCurrency(g)]})]}),m.length>0&&(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,b.jsx)("td",{style:{padding:"10px 0",color:"#059669"},children:"Amount Paid"}),(0,b.jsxs)("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:600,color:"#059669"},children:["-",o.formatCurrency(j)]})]}),(0,b.jsxs)("tr",{style:{background:"#1A3A5C"},children:[(0,b.jsx)("td",{style:{padding:"12px 10px",color:"white",fontWeight:600},children:"Balance Due"}),(0,b.jsx)("td",{style:{padding:"12px 10px",textAlign:"right",color:"white",fontSize:"16px",fontWeight:700,fontFamily:"monospace"},children:o.formatCurrency(k)})]})]})})}),m.length>0&&(0,b.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,b.jsx)("h3",{style:{fontSize:"12px",fontWeight:700,color:"#1A3A5C",marginBottom:"8px",borderBottom:"1px solid #ddd",paddingBottom:"6px"},children:"Payment History"}),(0,b.jsxs)("table",{style:{width:"100%",fontSize:"11px"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{background:"#f3f4f6"},children:[(0,b.jsx)("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:"#555"},children:"Date"}),(0,b.jsx)("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:"#555"},children:"Method"}),(0,b.jsx)("th",{style:{padding:"8px",textAlign:"left",fontWeight:600,color:"#555"},children:"Reference"}),(0,b.jsx)("th",{style:{padding:"8px",textAlign:"right",fontWeight:600,color:"#555"},children:"Amount"})]})}),(0,b.jsx)("tbody",{children:m.map(a=>(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,b.jsx)("td",{style:{padding:"8px",color:"#333"},children:a.date}),(0,b.jsx)("td",{style:{padding:"8px",color:"#333",textTransform:"capitalize"},children:a.method}),(0,b.jsxs)("td",{style:{padding:"8px",color:"#333",fontFamily:"monospace"},children:["#",a.id.slice(0,8).toUpperCase()]}),(0,b.jsx)("td",{style:{padding:"8px",textAlign:"right",fontWeight:600,color:"#059669"},children:o.formatCurrency(a.amount)})]},a.id))})]})]}),f.show_bank_details&&k>0&&(0,b.jsxs)("div",{style:{background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"4px",padding:"14px",marginBottom:"24px"},children:[(0,b.jsx)("h3",{style:{fontSize:"11px",fontWeight:700,color:"#92400E",margin:"0 0 10px 0"},children:"Bank Payment Details"}),(0,b.jsxs)("div",{style:{display:"flex",gap:"24px",fontSize:"11px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{style:{color:"#78350F"},children:"Bank: "}),(0,b.jsx)("strong",{style:{color:"#92400E"},children:f.bank_name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{style:{color:"#78350F"},children:"Account No: "}),(0,b.jsx)("strong",{style:{color:"#92400E",fontFamily:"monospace"},children:f.bank_account_number})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{style:{color:"#78350F"},children:"Account Name: "}),(0,b.jsx)("strong",{style:{color:"#92400E"},children:f.bank_account_name})]})]}),(0,b.jsxs)("p",{style:{color:"#92400E",marginTop:"8px",fontSize:"10px",margin:"8px 0 0 0"},children:["Use student ID ",(0,b.jsx)("strong",{children:a.student_no})," as payment reference"]})]}),f.invoice_notes&&(0,b.jsxs)("div",{style:{background:"#f9fafb",borderLeft:"3px solid #1A3A5C",padding:"12px 16px",marginBottom:"24px"},children:[(0,b.jsx)("p",{style:{fontSize:"10px",fontWeight:700,color:"#1A3A5C",margin:"0 0 4px 0"},children:"Note"}),(0,b.jsx)("p",{style:{fontSize:"11px",color:"#555",lineHeight:1.5,margin:0},children:f.invoice_notes})]}),(0,b.jsxs)("div",{style:{borderTop:"1px solid #ddd",paddingTop:"24px",marginTop:"24px"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsx)("div",{style:{width:"150px",borderBottom:"1px solid #333",height:"40px",marginBottom:"4px"}}),(0,b.jsx)("p",{style:{fontSize:"10px",fontWeight:600,color:"#333",margin:0},children:"Bursar's Signature"})]}),(0,b.jsx)("div",{style:{textAlign:"center"},children:(0,b.jsx)("p",{style:{fontSize:"20px",margin:"0 0 8px 0"},children:k>0?(0,b.jsx)("span",{style:{background:"#fef2f2",color:"#DC2626",padding:"6px 16px",borderRadius:"4px",fontSize:"12px",fontWeight:700},children:"PAYMENT DUE"}):(0,b.jsx)("span",{style:{background:"#ecfdf5",color:"#059669",padding:"6px 16px",borderRadius:"4px",fontSize:"12px",fontWeight:700},children:"PAID IN FULL"})})}),(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsx)("div",{style:{width:"150px",borderBottom:"1px solid #333",height:"40px",marginBottom:"4px"}}),(0,b.jsx)("p",{style:{fontSize:"10px",fontWeight:600,color:"#333",margin:0},children:f.head_of_school_name||"Head of School"})]})]}),(0,b.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",paddingTop:"12px",borderTop:"1px solid #eee"},children:[(0,b.jsxs)("p",{style:{fontSize:"11px",color:"#888",fontStyle:"italic",margin:0},children:['"',f.school_tagline,'"']}),(0,b.jsxs)("p",{style:{fontSize:"9px",color:"#aaa",margin:"6px 0 0 0"},children:["Generated: ",new Date().toLocaleString()," | Â© ",new Date().getFullYear()," ",f.school_name]})]})]})]})},y=[{value:"tuition",label:"Tuition Fees"},{value:"registration",label:"Registration Fee"},{value:"books",label:"Books & Materials"},{value:"uniform",label:"School Uniform"},{value:"transport",label:"Transport/Bus Fee"},{value:"exam",label:"Examination Fee"},{value:"excursion",label:"Excursion/Field Trip"},{value:"other",label:"Other"}],z=({settings:a,classes:d,students:e,fees:i,payments:j,showPayModal:k,setShowPayModal:l,showExpenseModal:p,setShowExpenseModal:q,showFeeModal:r,setShowFeeModal:s,receiptPayment:v,setReceiptPayment:z,invoiceStudent:A,setInvoiceStudent:B,selectedStudent:C,onAddPayment:D,onAddExpense:E,onAddFee:F,addToast:G})=>{let[H,I]=(0,c.useState)([{purpose:"tuition",amount:""}]),[J,K]=(0,c.useState)("cash"),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)("supplies"),[T,U]=(0,c.useState)(o.getTodayString()),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)(""),af=(a,b,c)=>{let d=[...H];d[a][b]=c,I(d)},ag=()=>H.reduce((a,b)=>a+(Number(b.amount)||0),0),ah=v?e.find(a=>a.id===v.student_id):null;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Modal,{isOpen:k,onClose:()=>l(!1),title:"Record Payment",children:(0,b.jsxs)("form",{onSubmit:b=>{if(b.preventDefault(),!C)return;let c=H.filter(a=>a.amount&&Number(a.amount)>0);if(0===c.length)return void G("Please add at least one payment item with an amount","error");let d=ag();D({id:o.generateId(),student_id:C,amount:d,method:J,lineItems:c.map(a=>({purpose:a.purpose,amount:Number(a.amount)})),remark:L,date:o.getTodayString(),session:a.current_session,term:a.current_term,created_at:Date.now(),updated_at:Date.now()}),G("Payment recorded successfully","success"),l(!1),I([{purpose:"tuition",amount:""}]),M("")},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Items"}),(0,b.jsxs)("button",{type:"button",onClick:()=>{I([...H,{purpose:"tuition",amount:""}])},className:"text-xs flex items-center gap-1 text-brand-600 hover:text-brand-700",children:[(0,b.jsx)(f.Plus,{size:14})," Add Item"]})]}),(0,b.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:H.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 p-2 rounded-lg",children:[(0,b.jsx)("select",{value:a.purpose,onChange:a=>af(c,"purpose",a.target.value),className:"flex-1 px-2 py-1.5 text-sm border border-gray-200 rounded-md focus:ring-1 focus:ring-brand-500 focus:border-brand-500",children:y.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))}),(0,b.jsx)("input",{type:"number",placeholder:"Amount",value:a.amount,onChange:a=>af(c,"amount",a.target.value),className:"w-28 px-2 py-1.5 text-sm border border-gray-200 rounded-md focus:ring-1 focus:ring-brand-500 focus:border-brand-500"}),H.length>1&&(0,b.jsx)("button",{type:"button",onClick:()=>{H.length>1&&I(H.filter((a,b)=>b!==c))},className:"p-1 text-red-500 hover:bg-red-50 rounded",children:(0,b.jsx)(h.Trash2,{size:16})})]},c))}),(0,b.jsxs)("div",{className:"mt-2 text-right text-sm font-semibold text-brand-600",children:["Total: ",o.formatCurrency(ag())]})]}),(0,b.jsxs)(n.Select,{label:"Payment Method",value:J,onChange:a=>K(a.target.value),children:[(0,b.jsx)("option",{value:"cash",children:"Cash"}),(0,b.jsx)("option",{value:"transfer",children:"Bank Transfer"}),(0,b.jsx)("option",{value:"pos",children:"POS"})]}),(0,b.jsx)(u.Input,{label:"Remark/Note (Optional)",value:L,onChange:a=>M(a.target.value)}),(0,b.jsx)(m.Button,{type:"submit",className:"w-full",children:"Save Payment"})]})}),(0,b.jsx)(t.Modal,{isOpen:!!v,onClose:()=>z(null),title:"Print Receipt",children:v&&ah&&(0,b.jsxs)("div",{className:"overflow-y-auto max-h-[80vh]",children:[(0,b.jsx)(w,{payment:v,student:ah,cls:d.find(a=>a.id===ah.class_id),settings:a}),(0,b.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,b.jsx)(m.Button,{variant:"secondary",onClick:()=>z(null),children:"Close"}),(0,b.jsxs)(m.Button,{onClick:()=>{let b=document.getElementById("receipt-print");if(!b)return;let c=window.open("","_blank");if(!c)return;let d=a.logo_media||"";c.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Payment Receipt - ${a.school_name}</title>
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; background: white; }
                    .receipt { max-width: 600px; margin: 0 auto; border: 2px solid #1A3A5C; border-radius: 8px; padding: 24px; position: relative; overflow: hidden; }
                    .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.06; width: 280px; height: 280px; pointer-events: none; z-index: 0; }
                    .watermark img { width: 100%; height: 100%; object-fit: contain; }
                    .content { position: relative; z-index: 1; }
                    @media print { body { padding: 0; } .receipt { border: none; } }
                </style>
            </head>
            <body>
                <div class="receipt">
                    ${d?`<div class="watermark"><img src="${d}" alt="Watermark" /></div>`:""}
                    <div class="content">
                        ${b.innerHTML}
                    </div>
                </div>
            </body>
            </html>
        `),c.document.close(),c.focus(),setTimeout(()=>{c.print(),c.close()},250)},children:[(0,b.jsx)(g.Printer,{className:"h-4 w-4 mr-2"})," Print"]})]})]})}),(0,b.jsx)(t.Modal,{isOpen:!!A,onClose:()=>{B(null),ac(""),ae("")},title:"Fee Invoice",children:A&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-amber-800 mb-3",children:"Apply Discount (Optional)"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-amber-700 mb-1",children:"Discount Amount (â‚¦)"}),(0,b.jsx)("input",{type:"number",placeholder:"0",value:ab,onChange:a=>ac(a.target.value),className:"w-full px-3 py-2 text-sm border border-amber-200 rounded-md focus:ring-2 focus:ring-amber-500 focus:border-amber-500 bg-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs text-amber-700 mb-1",children:"Reason"}),(0,b.jsxs)("select",{value:ad,onChange:a=>ae(a.target.value),className:"w-full px-3 py-2 text-sm border border-amber-200 rounded-md focus:ring-2 focus:ring-amber-500 focus:border-amber-500 bg-white",children:[(0,b.jsx)("option",{value:"",children:"Select reason"}),(0,b.jsx)("option",{value:"Scholarship",children:"Scholarship"}),(0,b.jsx)("option",{value:"Staff Ward",children:"Staff Ward"}),(0,b.jsx)("option",{value:"Sibling Discount",children:"Sibling Discount"}),(0,b.jsx)("option",{value:"Early Payment",children:"Early Payment"}),(0,b.jsx)("option",{value:"Financial Aid",children:"Financial Aid"}),(0,b.jsx)("option",{value:"Special Arrangement",children:"Special Arrangement"})]})]})]})]}),(0,b.jsx)("div",{className:"overflow-y-auto max-h-[60vh] border rounded-lg p-2 bg-gray-50",children:(0,b.jsx)(x,{student:A,cls:d.find(a=>a.id===A.class_id),fees:i,payments:j,settings:a,discount:Number(ab)||0,discountReason:ad})}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[(0,b.jsx)(m.Button,{variant:"secondary",onClick:()=>{B(null),ac(""),ae("")},children:"Close"}),(0,b.jsxs)(m.Button,{onClick:()=>{let b=document.getElementById("invoice-print");if(!b)return;let c=window.open("","_blank");if(!c)return;let d=a.logo_media||"";c.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Fee Invoice - ${a.school_name}</title>
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
                    body { font-family: 'Segoe UI', Arial, sans-serif; padding: 15px; background: white; }
                    .invoice { max-width: 700px; margin: 0 auto; padding: 20px; position: relative; overflow: hidden; }
                    .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.05; width: 350px; height: 350px; pointer-events: none; z-index: 0; }
                    .watermark img { width: 100%; height: 100%; object-fit: contain; }
                    .content { position: relative; z-index: 1; }
                    @media print { 
                        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
                        body { padding: 0; } 
                        .invoice { max-width: 100%; padding: 10px; }
                    }
                </style>
            </head>
            <body>
                <div class="invoice">
                    ${d?`<div class="watermark"><img src="${d}" alt="Watermark" /></div>`:""}
                    <div class="content">
                        ${b.innerHTML}
                    </div>
                </div>
            </body>
            </html>
        `),c.document.close(),c.focus(),setTimeout(()=>{c.print(),c.close()},250)},children:[(0,b.jsx)(g.Printer,{className:"h-4 w-4 mr-2"})," Print Invoice"]})]})]})}),(0,b.jsx)(t.Modal,{isOpen:p,onClose:()=>q(!1),title:"Record Expense",children:(0,b.jsxs)("form",{onSubmit:b=>{b.preventDefault(),E({id:o.generateId(),title:N,amount:Number(P),category:R,date:T,description:V||void 0,session:a.current_session,term:a.current_term,created_at:Date.now(),updated_at:Date.now()}),G("Expense recorded","success"),q(!1),O(""),Q(""),W("")},className:"space-y-4",children:[(0,b.jsx)(u.Input,{label:"Title",required:!0,value:N,onChange:a=>O(a.target.value),placeholder:"e.g. Classroom repairs"}),(0,b.jsx)(u.Input,{label:"Amount",type:"number",required:!0,value:P,onChange:a=>Q(a.target.value)}),(0,b.jsxs)(n.Select,{label:"Category",value:R,onChange:a=>S(a.target.value),children:[(0,b.jsx)("option",{value:"supplies",children:"Supplies"}),(0,b.jsx)("option",{value:"maintenance",children:"Maintenance"}),(0,b.jsx)("option",{value:"salary",children:"Salary"}),(0,b.jsx)("option",{value:"utilities",children:"Utilities"}),(0,b.jsx)("option",{value:"other",children:"Other"})]}),(0,b.jsx)(u.Input,{label:"Date",type:"date",value:T,onChange:a=>U(a.target.value)}),(0,b.jsx)(u.Input,{label:"Description (Optional)",value:V,onChange:a=>W(a.target.value),placeholder:"Additional details..."}),(0,b.jsx)(m.Button,{type:"submit",className:"w-full",children:"Save Expense"})]})}),(0,b.jsx)(t.Modal,{isOpen:r,onClose:()=>s(!1),title:"Add Fee Structure",children:(0,b.jsxs)("form",{onSubmit:b=>{b.preventDefault(),F({id:o.generateId(),name:X,amount:Number(Z),class_id:_||null,session:a.current_session,term:a.current_term,created_at:Date.now(),updated_at:Date.now()}),G("Fee structure added","success"),s(!1),Y(""),$(""),aa("")},className:"space-y-4",children:[(0,b.jsx)(u.Input,{label:"Fee Name",required:!0,value:X,onChange:a=>Y(a.target.value),placeholder:"e.g. Tuition Fee"}),(0,b.jsx)(u.Input,{label:"Amount",type:"number",required:!0,value:Z,onChange:a=>$(a.target.value)}),(0,b.jsxs)(n.Select,{label:"Applicable Class",value:_,onChange:a=>aa(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"All Classes"}),d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)(m.Button,{type:"submit",className:"w-full",children:"Create Fee"})]})})]})};var A=a.i(24669),B=a.i(53277),C=a.i(90166),D=a.i(73570);let E=({students:a,classes:c,fees:d,payments:e,expenses:f,settings:g})=>{let h=e.filter(a=>a.session===g.current_session&&a.term===g.current_term),i=f.filter(a=>a.session===g.current_session&&a.term===g.current_term),j=d.filter(a=>a.session===g.current_session&&a.term===g.current_term),k=h.reduce((a,b)=>a+b.amount,0),m=i.reduce((a,b)=>a+b.amount,0),n=k-m,p=a.reduce((a,b)=>a+j.filter(a=>null===a.class_id||a.class_id===b.class_id).reduce((a,b)=>a+b.amount,0),0),q=p>0?k/p*100:0,r=a.map(a=>{let{balance:b}=o.getStudentBalance(a,d,e,g.current_session,g.current_term);return{student:a,balance:b}}).filter(a=>a.balance>0).sort((a,b)=>b.balance-a.balance),s=r.reduce((a,b)=>a+b.balance,0),t=h.reduce((a,b)=>(a[b.method]=(a[b.method]||0)+b.amount,a),{}),u=i.reduce((a,b)=>(a[b.category]=(a[b.category]||0)+b.amount,a),{}),v=[...h].sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()).slice(0,5);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white p-5",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-green-100 text-sm font-medium",children:"Total Income"}),(0,b.jsx)("p",{className:"text-2xl font-bold mt-1",children:o.formatCurrency(k)}),(0,b.jsxs)("p",{className:"text-green-200 text-xs mt-1",children:[h.length," payments"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-white/20 rounded-xl flex items-center justify-center",children:(0,b.jsx)(A.TrendingUp,{size:24})})]})}),(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-red-500 to-red-600 text-white p-5",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-red-100 text-sm font-medium",children:"Total Expenses"}),(0,b.jsx)("p",{className:"text-2xl font-bold mt-1",children:o.formatCurrency(m)}),(0,b.jsxs)("p",{className:"text-red-200 text-xs mt-1",children:[i.length," records"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-white/20 rounded-xl flex items-center justify-center",children:(0,b.jsx)(B.TrendingDown,{size:24})})]})}),(0,b.jsx)(l.Card,{className:`bg-gradient-to-br ${n>=0?"from-blue-500 to-blue-600":"from-orange-500 to-orange-600"} text-white p-5`,children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white/80 text-sm font-medium",children:"Net Balance"}),(0,b.jsx)("p",{className:"text-2xl font-bold mt-1",children:o.formatCurrency(n)}),(0,b.jsx)("p",{className:"text-white/60 text-xs mt-1",children:n>=0?"Profit":"Loss"})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-white/20 rounded-xl flex items-center justify-center",children:(0,b.jsx)(C.DollarSign,{size:24})})]})}),(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-amber-500 to-amber-600 text-white p-5",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-amber-100 text-sm font-medium",children:"Outstanding Fees"}),(0,b.jsx)("p",{className:"text-2xl font-bold mt-1",children:o.formatCurrency(s)}),(0,b.jsxs)("p",{className:"text-amber-200 text-xs mt-1",children:[r.length," debtors"]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-white/20 rounded-xl flex items-center justify-center",children:(0,b.jsx)(D.AlertTriangle,{size:24})})]})})]}),(0,b.jsxs)(l.Card,{className:"p-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Fee Collection Progress"}),(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[g.current_session," - ",g.current_term]})]}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:["Collected: ",o.formatCurrency(k)]}),(0,b.jsxs)("span",{className:"text-gray-600",children:["Expected: ",o.formatCurrency(p)]})]}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600 rounded-full transition-all duration-500",style:{width:`${Math.min(q,100)}%`}})})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[q.toFixed(1),"% collection rate"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(l.Card,{className:"p-5",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Payment Methods"}),(0,b.jsxs)("div",{className:"space-y-3",children:[Object.entries(t).map(([a,c])=>{let d=k>0?c/k*100:0;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,b.jsx)("span",{className:"capitalize text-gray-700",children:a}),(0,b.jsx)("span",{className:"font-medium",children:o.formatCurrency(c)})]}),(0,b.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-brand-500 rounded-full",style:{width:`${d}%`}})})]},a)}),0===Object.keys(t).length&&(0,b.jsx)("p",{className:"text-gray-400 text-sm text-center py-4",children:"No payments recorded"})]})]}),(0,b.jsxs)(l.Card,{className:"p-5",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Expense Categories"}),(0,b.jsxs)("div",{className:"space-y-3",children:[Object.entries(u).map(([a,c])=>{let d=m>0?c/m*100:0;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,b.jsx)("span",{className:"capitalize text-gray-700",children:a}),(0,b.jsxs)("span",{className:"font-medium text-red-600",children:["-",o.formatCurrency(c)]})]}),(0,b.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-red-400 rounded-full",style:{width:`${d}%`}})})]},a)}),0===Object.keys(u).length&&(0,b.jsx)("p",{className:"text-gray-400 text-sm text-center py-4",children:"No expenses recorded"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(l.Card,{className:"p-5",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Payments"}),(0,b.jsxs)("div",{className:"space-y-3",children:[v.map(c=>{let d=a.find(a=>a.id===c.student_id);return(0,b.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:d?.names||"Unknown"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[c.date," â€¢ ",c.method]})]}),(0,b.jsx)("span",{className:"font-semibold text-green-600",children:o.formatCurrency(c.amount)})]},c.id)}),0===v.length&&(0,b.jsx)("p",{className:"text-gray-400 text-sm text-center py-4",children:"No recent payments"})]})]}),(0,b.jsxs)(l.Card,{className:"p-5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Top Debtors"}),(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:[r.length," students owing"]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[r.slice(0,5).map(({student:a,balance:d})=>{let e=c.find(b=>b.id===a.class_id);return(0,b.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:a.names}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[e?.name," â€¢ ",a.student_no]})]}),(0,b.jsx)("span",{className:"font-semibold text-red-600",children:o.formatCurrency(d)})]},a.id)}),0===r.length&&(0,b.jsx)("p",{className:"text-green-600 text-sm text-center py-4",children:"ðŸŽ‰ No outstanding fees!"})]})]})]})]})};var F=a.i(63519);let G=({students:a,classes:d,fees:e,payments:f,settings:h})=>{let[i,k]=(0,c.useState)(""),[p,q]=(0,c.useState)("all"),[r,s]=(0,c.useState)("balance"),[t,v]=(0,c.useState)(""),w=a.map(a=>{let b=d.find(b=>b.id===a.class_id),{totalBill:c,totalPaid:g,balance:i}=o.getStudentBalance(a,e,f,h.current_session,h.current_term);return{student:a,cls:b,totalBill:c,totalPaid:g,balance:i}}).filter(a=>a.balance>0),x=[...w];i&&(x=x.filter(a=>a.student.names.toLowerCase().includes(i.toLowerCase())||a.student.student_no.toLowerCase().includes(i.toLowerCase())||a.student.parent_name.toLowerCase().includes(i.toLowerCase()))),"all"!==p&&(x=x.filter(a=>a.student.class_id===p)),t&&(x=x.filter(a=>a.balance>=Number(t))),"balance"===r?x.sort((a,b)=>b.balance-a.balance):x.sort((a,b)=>a.student.names.localeCompare(b.student.names));let y=x.reduce((a,b)=>a+b.balance,0);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(l.Card,{className:"p-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 items-end",children:[(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Search by name, ID, or parent...",value:i,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-brand-500 focus:border-brand-500"})]})]}),(0,b.jsxs)(n.Select,{label:"Class",value:p,onChange:a=>q(a.target.value),children:[(0,b.jsx)("option",{value:"all",children:"All Classes"}),d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)(u.Input,{label:"Min Amount",type:"number",placeholder:"0",value:t,onChange:a=>v(a.target.value)}),(0,b.jsxs)(m.Button,{onClick:()=>{let a=window.open("","_blank");a&&(a.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Debtor Report - ${h.school_name}</title>
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; }
                    .header { text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #1A3A5C; }
                    .school-name { font-size: 20px; font-weight: 800; color: #1A3A5C; }
                    .report-title { font-size: 14px; color: #666; margin-top: 5px; }
                    .summary { display: flex; justify-content: space-between; margin-bottom: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; }
                    table { width: 100%; border-collapse: collapse; font-size: 11px; }
                    th { background: #1A3A5C; color: white; padding: 8px; text-align: left; }
                    td { padding: 8px; border-bottom: 1px solid #ddd; }
                    tr:nth-child(even) { background: #f9f9f9; }
                    .amount { text-align: right; font-weight: 600; }
                    .total-row { background: #1A3A5C !important; color: white; font-weight: bold; }
                    .footer { margin-top: 20px; text-align: center; font-size: 10px; color: #999; }
                </style>
            </head>
            <body>
                <div class="header">
                    <div class="school-name">${h.school_name}</div>
                    <div class="report-title">DEBTOR REPORT - ${h.current_session} (${h.current_term})</div>
                    <div class="report-title">Generated: ${new Date().toLocaleDateString()}</div>
                </div>
                <div class="summary">
                    <span>Total Debtors: ${x.length}</span>
                    <span>Total Outstanding: ${o.formatCurrency(y)}</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>S/N</th>
                            <th>Student Name</th>
                            <th>Student ID</th>
                            <th>Class</th>
                            <th>Parent/Guardian</th>
                            <th>Phone</th>
                            <th class="amount">Total Bill</th>
                            <th class="amount">Paid</th>
                            <th class="amount">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${x.map((a,b)=>`
                            <tr>
                                <td>${b+1}</td>
                                <td>${a.student.names}</td>
                                <td>${a.student.student_no}</td>
                                <td>${a.cls?.name||"N/A"}</td>
                                <td>${a.student.parent_name}</td>
                                <td>${a.student.parent_phone}</td>
                                <td class="amount">${o.formatCurrency(a.totalBill)}</td>
                                <td class="amount">${o.formatCurrency(a.totalPaid)}</td>
                                <td class="amount" style="color: #c53030;">${o.formatCurrency(a.balance)}</td>
                            </tr>
                        `).join("")}
                        <tr class="total-row">
                            <td colspan="6">TOTAL</td>
                            <td class="amount">${o.formatCurrency(x.reduce((a,b)=>a+b.totalBill,0))}</td>
                            <td class="amount">${o.formatCurrency(x.reduce((a,b)=>a+b.totalPaid,0))}</td>
                            <td class="amount">${o.formatCurrency(y)}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="footer">${h.school_tagline}</div>
            </body>
            </html>
        `),a.document.close(),a.focus(),setTimeout(()=>{a.print(),a.close()},250))},className:"h-10",children:[(0,b.jsx)(g.Printer,{className:"h-4 w-4 mr-2"})," Print Report"]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(l.Card,{className:"p-4 bg-red-50 border-red-100",children:[(0,b.jsx)("p",{className:"text-sm text-red-600",children:"Total Outstanding"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-red-700",children:o.formatCurrency(y)})]}),(0,b.jsxs)(l.Card,{className:"p-4 bg-amber-50 border-amber-100",children:[(0,b.jsx)("p",{className:"text-sm text-amber-600",children:"Number of Debtors"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-amber-700",children:x.length})]}),(0,b.jsxs)(l.Card,{className:"p-4 bg-blue-50 border-blue-100",children:[(0,b.jsx)("p",{className:"text-sm text-blue-600",children:"Average Debt"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:x.length>0?o.formatCurrency(y/x.length):"â‚¦0"})]})]}),(0,b.jsx)(l.Card,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50 text-gray-700",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"S/N"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"Student"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"Class"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"Parent/Guardian"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left",children:"Contact"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Total Bill"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Paid"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"Balance"})]})}),(0,b.jsxs)("tbody",{className:"divide-y divide-gray-100",children:[x.map((a,c)=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-3 text-gray-500",children:c+1}),(0,b.jsxs)("td",{className:"px-4 py-3",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:a.student.names}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.student.student_no})]}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs",children:a.cls?.name||"N/A"})}),(0,b.jsx)("td",{className:"px-4 py-3 text-gray-700",children:a.student.parent_name}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("a",{href:`tel:${a.student.parent_phone}`,className:"text-brand-600 hover:text-brand-700",children:(0,b.jsx)(F.Phone,{size:14})}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.student.parent_phone})]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono",children:o.formatCurrency(a.totalBill)}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono text-green-600",children:o.formatCurrency(a.totalPaid)}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono font-bold text-red-600",children:o.formatCurrency(a.balance)})]},a.student.id)),0===x.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:0===w.length?"ðŸŽ‰ No outstanding fees - all students are up to date!":"No debtors match your filter criteria."})})]}),x.length>0&&(0,b.jsx)("tfoot",{className:"bg-gray-100 font-bold",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{colSpan:5,className:"px-4 py-3 text-right",children:"TOTAL:"}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono",children:o.formatCurrency(x.reduce((a,b)=>a+b.totalBill,0))}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono text-green-600",children:o.formatCurrency(x.reduce((a,b)=>a+b.totalPaid,0))}),(0,b.jsx)("td",{className:"px-4 py-3 text-right font-mono text-red-600",children:o.formatCurrency(y)})]})})]})})})]})},H=({students:a,classes:d,fees:f,payments:g,expenses:h,settings:i,onAddPayment:j,onAddFee:k,onAddExpense:l,onDeletePayment:m,onDeleteFee:n,onDeleteExpense:o})=>{let[q,t]=(0,c.useState)("dashboard"),[u,v]=(0,c.useState)(d[0]?.id||""),[w,x]=(0,c.useState)(null),[y,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,F]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),{addToast:L}=(0,e.useToast)();return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Bursary & Finance"}),(0,b.jsx)("div",{className:"flex bg-gray-100 p-1 rounded-lg overflow-x-auto",children:[{key:"dashboard",label:"Dashboard"},{key:"fees",label:"Fee Collection"},{key:"debtors",label:"Debtors"},{key:"expenses",label:"Expenses"},{key:"structure",label:"Fee Structure"}].map(a=>(0,b.jsx)("button",{onClick:()=>t(a.key),className:`px-3 py-2 text-sm font-medium rounded-md whitespace-nowrap ${q===a.key?"bg-white shadow-sm text-brand-700":"text-gray-600 hover:text-gray-900"}`,children:a.label},a.key))})]}),"dashboard"===q&&(0,b.jsx)(E,{students:a,classes:d,fees:f,payments:g,expenses:h,settings:i}),"fees"===q&&(0,b.jsx)(p,{students:a,classes:d,fees:f,payments:g,settings:i,selectedClass:u,setSelectedClass:v,selectedStudent:w,setSelectedStudent:x,onRecordPayment:()=>A(!0),onPrintReceipt:a=>I(a),onDeletePayment:m,onPrintInvoice:a=>K(a)}),"debtors"===q&&(0,b.jsx)(G,{students:a,classes:d,fees:f,payments:g,settings:i}),"expenses"===q&&(0,b.jsx)(r,{expenses:h,settings:i,onAddExpense:()=>C(!0),onDeleteExpense:o}),"structure"===q&&(0,b.jsx)(s,{fees:f,classes:d,settings:i,onAddFeeHead:()=>F(!0),onDeleteFee:n}),(0,b.jsx)(z,{settings:i,classes:d,students:a,fees:f,payments:g,showPayModal:y,setShowPayModal:A,showExpenseModal:B,setShowExpenseModal:C,showFeeModal:D,setShowFeeModal:F,receiptPayment:H,setReceiptPayment:I,invoiceStudent:J,setInvoiceStudent:K,selectedStudent:w,onAddPayment:j,onAddExpense:l,onAddFee:k,addToast:L})]})};var I=a.i(11156);let J=(0,a.i(70106).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var K=a.i(41710),L=a.i(92e3);let M=({student:c,cls:d,fees:e,payments:f,settings:h})=>{let{totalBill:i,totalPaid:j,balance:n}=o.getStudentBalance(c,e,f,h.current_session,h.current_term),p=e.filter(a=>a.session===h.current_session&&a.term===h.current_term&&(null===a.class_id||a.class_id===c.class_id)),q=f.filter(a=>a.student_id===c.id&&a.session===h.current_session&&a.term===h.current_term).sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()),r=n<=0?"paid":n<i?"partial":"unpaid";return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Fee Statement"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[h.current_term," â€¢ ",h.current_session]})]}),(0,b.jsxs)(m.Button,{onClick:()=>{let e=window.open("","_blank","width=800,height=800");e?(e.document.write("<html><head><title>Print Invoice</title>"),e.document.write("<style>"),e.document.write("@page { margin: 20mm; }"),e.document.write("body { margin: 0; padding: 20px 40px; }"),e.document.write("</style>"),e.document.write("</head><body>"),e.document.write('<div id="print-root"></div>'),e.document.write("</body></html>"),e.document.close(),a.A(32722).then(({createRoot:a})=>{a(e.document.getElementById("print-root")).render((0,b.jsx)(x,{student:c,cls:d,fees:p,payments:q,settings:h})),setTimeout(()=>{e.focus(),e.print()},500)})):alert("Please allow popups to print the invoice")},className:"flex gap-2",children:[(0,b.jsx)(g.Printer,{size:16}),"Print Invoice"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(l.Card,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)(k.FileText,{className:"h-6 w-6 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Total Bill"}),(0,b.jsxs)("p",{className:"text-2xl font-black text-gray-900",children:["â‚¦",i.toLocaleString()]})]})]})}),(0,b.jsx)(l.Card,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)(J,{className:"h-6 w-6 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Amount Paid"}),(0,b.jsxs)("p",{className:"text-2xl font-black text-green-600",children:["â‚¦",j.toLocaleString()]})]})]})}),(0,b.jsx)(l.Card,{className:`p-6 ${n>0?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:`h-12 w-12 rounded-xl flex items-center justify-center ${n>0?"bg-red-100":"bg-green-100"}`,children:n>0?(0,b.jsx)(L.AlertCircle,{className:"h-6 w-6 text-red-600"}):(0,b.jsx)(J,{className:"h-6 w-6 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:n>0?"Balance Due":"Status"}),(0,b.jsx)("p",{className:`text-2xl font-black ${n>0?"text-red-600":"text-green-600"}`,children:n>0?`â‚¦${n.toLocaleString()}`:"Fully Paid"})]})]})})]}),(0,b.jsxs)(l.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Student Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-400 text-xs uppercase font-medium",children:"Name"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:c.names})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-400 text-xs uppercase font-medium",children:"Admission No"}),(0,b.jsx)("p",{className:"font-semibold text-brand-600",children:c.student_no})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-400 text-xs uppercase font-medium",children:"Class"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:d?.name||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-400 text-xs uppercase font-medium",children:"Status"}),(0,b.jsxs)("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold uppercase ${"paid"===r?"bg-green-100 text-green-700":"partial"===r?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:["paid"===r?(0,b.jsx)(J,{size:12}):(0,b.jsx)(K.Clock,{size:12}),"paid"===r?"Paid":"partial"===r?"Partial":"Unpaid"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(l.Card,{className:"p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(k.FileText,{size:18,className:"text-brand-500"}),"Fee Breakdown"]}),p.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[p.map((a,c)=>(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-xl",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:a.name}),(0,b.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["â‚¦",a.amount.toLocaleString()]})]},a.id)),(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-brand-50 rounded-xl border border-brand-100 mt-4",children:[(0,b.jsx)("span",{className:"text-sm font-bold text-brand-700",children:"Total"}),(0,b.jsxs)("span",{className:"text-lg font-black text-brand-700",children:["â‚¦",i.toLocaleString()]})]})]}):(0,b.jsx)("div",{className:"text-center py-8 text-gray-400 italic text-sm",children:"No fees set for this term."})]}),(0,b.jsxs)(l.Card,{className:"p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(I.CreditCard,{size:18,className:"text-green-500"}),"Payment History"]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,b.jsx)("span",{children:"Payment Progress"}),(0,b.jsxs)("span",{children:[Math.min(100,Math.round(j/i*100)),"%"]})]}),(0,b.jsx)("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full rounded-full transition-all duration-500 ${j>=i?"bg-green-500":j>0?"bg-yellow-500":"bg-gray-300"}`,style:{width:`${Math.min(100,j/i*100)}%`}})}),(0,b.jsxs)("div",{className:"flex justify-between text-xs mt-1",children:[(0,b.jsxs)("span",{className:"text-green-600 font-medium",children:["â‚¦",j.toLocaleString()]}),(0,b.jsxs)("span",{className:"text-gray-400",children:["of â‚¦",i.toLocaleString()]})]})]}),q.length>0?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-2 bottom-2 w-0.5 bg-green-200"}),(0,b.jsx)("div",{className:"space-y-4",children:q.map((a,c)=>(0,b.jsxs)("div",{className:"relative pl-8",children:[(0,b.jsx)("div",{className:"absolute left-1.5 top-2 w-3 h-3 bg-green-500 rounded-full border-2 border-white shadow"}),(0,b.jsx)("div",{className:"p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm font-bold text-gray-900",children:["â‚¦",a.amount.toLocaleString()]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:new Date(a.date).toLocaleDateString("en-GB",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})}),a.lineItems&&a.lineItems.length>0&&(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:a.lineItems.map(a=>a.purpose).join(", ")})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-[10px] font-bold uppercase",children:a.method})})]})})]},a.id))}),(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-xl border border-green-100 mt-4 ml-8",children:[(0,b.jsx)("span",{className:"text-sm font-bold text-green-700",children:"Total Paid"}),(0,b.jsxs)("span",{className:"text-lg font-black text-green-700",children:["â‚¦",j.toLocaleString()]})]})]}):(0,b.jsx)("div",{className:"text-center py-8 text-gray-400 italic text-sm",children:"No payments recorded yet."})]})]}),h.show_bank_details&&n>0&&(0,b.jsxs)(l.Card,{className:"p-6 bg-amber-50 border-amber-200",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-amber-800 mb-4",children:"Payment Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-amber-600 text-xs uppercase font-medium",children:"Bank Name"}),(0,b.jsx)("p",{className:"font-semibold text-amber-900",children:h.bank_name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-amber-600 text-xs uppercase font-medium",children:"Account Name"}),(0,b.jsx)("p",{className:"font-semibold text-amber-900",children:h.bank_account_name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-amber-600 text-xs uppercase font-medium",children:"Account Number"}),(0,b.jsx)("p",{className:"font-bold text-amber-900 text-lg",children:h.bank_account_number})]}),h.bank_sort_code&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-amber-600 text-xs uppercase font-medium",children:"Sort Code"}),(0,b.jsx)("p",{className:"font-semibold text-amber-900",children:h.bank_sort_code})]})]}),h.invoice_notes&&(0,b.jsx)("p",{className:"text-sm text-amber-700 mt-4 italic",children:h.invoice_notes})]})]})};var N=a.i(91016);function O(){let{currentRole:a,currentUser:e}=(0,d.useSchoolStore)(),{data:f=[]}=(0,N.useStudents)(),{data:g=[]}=(0,N.useClasses)(),{data:h=[]}=(0,N.useFees)(),{data:i=[]}=(0,N.usePayments)(),{data:j=[]}=(0,N.useExpenses)(),{data:k=o.INITIAL_SETTINGS}=(0,N.useSettings)(),{mutate:l}=(0,N.useCreatePayment)(),{mutate:m}=(0,N.useCreateFee)(),{mutate:n}=(0,N.useCreateExpense)(),{mutate:p}=(0,N.useDeletePayment)(),{mutate:q}=(0,N.useDeleteFee)(),{mutate:r}=(0,N.useDeleteExpense)(),s="student"===a||"parent"===a,t=(0,c.useMemo)(()=>{if(!s)return null;let a=e?.student_id||f[0]?.id;return f.find(b=>b.id===a)||f[0]},[s,e,f]),u=(0,c.useMemo)(()=>{if(t)return g.find(a=>a.id===t.class_id)},[t,g]);return s&&t?(0,b.jsx)(M,{student:t,cls:u,fees:h,payments:i,settings:k}):(0,b.jsx)(H,{students:f,classes:g,fees:h,payments:i,expenses:j,settings:k,onAddPayment:l,onAddFee:m,onAddExpense:n,onDeletePayment:p,onDeleteFee:q,onDeleteExpense:r})}a.s(["default",()=>O],15553)}];

//# sourceMappingURL=app_%28dashboard%29_bursary_page_tsx_5522eb43._.js.map