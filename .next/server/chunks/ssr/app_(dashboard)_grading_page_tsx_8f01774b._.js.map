{"version":3,"sources":["../../../../components/features/grading/SubjectTeacherManager.tsx","../../../../components/features/grading/TermComparisonView.tsx","../../../../components/features/grading/PromotionManager.tsx","../../../../components/features/grading/StudentScoresView.tsx","../../../../app/%28dashboard%29/grading/page.tsx","../../../../node_modules/lucide-react/src/icons/minus.ts","../../../../node_modules/lucide-react/src/icons/check.ts"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Plus, Trash2, UserCheck, BookOpen } from 'lucide-react';\r\nimport { useSchoolStore } from '@/lib/store';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select } from '@/components/ui/select';\r\nimport { useToast } from '@/components/providers/toast-provider';\r\nimport * as Utils from '@/lib/utils';\r\nimport {\r\n    useClasses, useTeachers, useSubjectTeachers, useSettings,\r\n    useCreateSubjectTeacher, useDeleteSubjectTeacher\r\n} from '@/lib/hooks/use-data';\r\n\r\nexport const SubjectTeacherManager: React.FC = () => {\r\n    // Auth\r\n    const { addToast } = useToast();\r\n\r\n    // Data Hooks\r\n    const { data: classes = [] } = useClasses();\r\n    const { data: teachers = [] } = useTeachers();\r\n    const { data: subjectTeachers = [] } = useSubjectTeachers();\r\n    const { data: settings = Utils.INITIAL_SETTINGS } = useSettings();\r\n\r\n    // Mutations\r\n    const { mutate: addSubjectTeacher } = useCreateSubjectTeacher();\r\n    const { mutate: removeSubjectTeacher } = useDeleteSubjectTeacher();\r\n\r\n    const [selectedClass, setSelectedClass] = useState(classes[0]?.id || '');\r\n    const [selectedTeacher, setSelectedTeacher] = useState('');\r\n    const [selectedSubject, setSelectedSubject] = useState('');\r\n\r\n    const currentClass = classes.find(c => c.id === selectedClass);\r\n    const classSubjects = Utils.getSubjectsForClass(currentClass);\r\n\r\n    // Get assignments for current class\r\n    const classAssignments = subjectTeachers.filter(\r\n        st => st.class_id === selectedClass && st.session === settings.current_session\r\n    );\r\n\r\n    const handleAddAssignment = () => {\r\n        if (!selectedTeacher || !selectedSubject) {\r\n            addToast('Please select both a teacher and a subject', 'warning');\r\n            return;\r\n        }\r\n\r\n        // Check if assignment already exists\r\n        const exists = classAssignments.some(\r\n            a => a.subject === selectedSubject\r\n        );\r\n        if (exists) {\r\n            addToast('This subject is already assigned to a teacher', 'error');\r\n            return;\r\n        }\r\n\r\n        addSubjectTeacher({\r\n            id: Utils.generateId(),\r\n            teacher_id: selectedTeacher,\r\n            class_id: selectedClass,\r\n            subject: selectedSubject,\r\n            session: settings.current_session,\r\n            created_at: Date.now(),\r\n            updated_at: Date.now()\r\n        });\r\n\r\n        addToast('Subject-teacher assignment added', 'success');\r\n        setSelectedSubject('');\r\n        setSelectedTeacher('');\r\n    };\r\n\r\n    const getTeacherName = (teacherId: string) => {\r\n        return teachers.find(t => t.id === teacherId)?.name || 'Unknown';\r\n    };\r\n\r\n    // Get subjects that are not yet assigned\r\n    const unassignedSubjects = classSubjects.filter(\r\n        subj => !classAssignments.some(a => a.subject === subj)\r\n    );\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold text-gray-900\">Subject-Teacher Assignments</h2>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">Assign teachers to subjects for each class</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* Left Panel: Assignment Form */}\r\n                <Card className=\"lg:col-span-1\">\r\n                    <div className=\"p-4 space-y-4\">\r\n                        <h3 className=\"font-semibold text-gray-700 flex items-center gap-2\">\r\n                            <Plus className=\"h-4 w-4\" />\r\n                            New Assignment\r\n                        </h3>\r\n\r\n                        <Select\r\n                            label=\"Class\"\r\n                            value={selectedClass}\r\n                            onChange={e => setSelectedClass(e.target.value)}\r\n                        >\r\n                            {classes.map(c => (\r\n                                <option key={c.id} value={c.id}>{c.name}</option>\r\n                            ))}\r\n                        </Select>\r\n\r\n                        <Select\r\n                            label=\"Subject\"\r\n                            value={selectedSubject}\r\n                            onChange={e => setSelectedSubject(e.target.value)}\r\n                        >\r\n                            <option value=\"\">-- Select Subject --</option>\r\n                            {unassignedSubjects.map(subj => (\r\n                                <option key={subj} value={subj}>{subj}</option>\r\n                            ))}\r\n                        </Select>\r\n\r\n                        <Select\r\n                            label=\"Teacher\"\r\n                            value={selectedTeacher}\r\n                            onChange={e => setSelectedTeacher(e.target.value)}\r\n                        >\r\n                            <option value=\"\">-- Select Teacher --</option>\r\n                            {teachers.map(t => (\r\n                                <option key={t.id} value={t.id}>{t.name}</option>\r\n                            ))}\r\n                        </Select>\r\n\r\n                        <Button\r\n                            className=\"w-full\"\r\n                            onClick={handleAddAssignment}\r\n                            disabled={!selectedTeacher || !selectedSubject}\r\n                        >\r\n                            <Plus className=\"h-4 w-4 mr-2\" />\r\n                            Add Assignment\r\n                        </Button>\r\n                    </div>\r\n                </Card>\r\n\r\n                {/* Right Panel: Current Assignments */}\r\n                <Card className=\"lg:col-span-2\">\r\n                    <div className=\"p-4\">\r\n                        <h3 className=\"font-semibold text-gray-700 flex items-center gap-2 mb-4\">\r\n                            <UserCheck className=\"h-4 w-4\" />\r\n                            Current Assignments for {currentClass?.name || 'Class'}\r\n                        </h3>\r\n\r\n                        {classAssignments.length === 0 ? (\r\n                            <div className=\"text-center py-12 text-gray-400\">\r\n                                <BookOpen className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\r\n                                <p>No subject-teacher assignments yet</p>\r\n                                <p className=\"text-sm mt-1\">Use the form on the left to add assignments</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-2\">\r\n                                {classAssignments.map(assignment => (\r\n                                    <div\r\n                                        key={assignment.id}\r\n                                        className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg border\"\r\n                                    >\r\n                                        <div className=\"flex items-center gap-4\">\r\n                                            <div className=\"h-10 w-10 bg-brand-100 rounded-lg flex items-center justify-center\">\r\n                                                <BookOpen className=\"h-5 w-5 text-brand-600\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"font-medium text-gray-900\">{assignment.subject}</p>\r\n                                                <p className=\"text-sm text-gray-500\">\r\n                                                    Taught by: {getTeacherName(assignment.teacher_id)}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                removeSubjectTeacher(assignment.id);\r\n                                                addToast('Assignment removed', 'info');\r\n                                            }}\r\n                                            className=\"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                                        >\r\n                                            <Trash2 className=\"h-4 w-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Summary by Class */}\r\n            <Card>\r\n                <div className=\"p-4\">\r\n                    <h3 className=\"font-semibold text-gray-700 mb-4\">Assignment Summary by Class</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n                        {classes.map(cls => {\r\n                            const assignments = subjectTeachers.filter(\r\n                                st => st.class_id === cls.id && st.session === settings.current_session\r\n                            );\r\n                            const subjects = Utils.getSubjectsForClass(cls);\r\n                            const coverage = subjects.length > 0\r\n                                ? Math.round((assignments.length / subjects.length) * 100)\r\n                                : 0;\r\n\r\n                            return (\r\n                                <div\r\n                                    key={cls.id}\r\n                                    className={`p-3 rounded-lg border cursor-pointer transition-colors ${selectedClass === cls.id\r\n                                        ? 'bg-brand-50 border-brand-200'\r\n                                        : 'bg-gray-50 hover:bg-gray-100'\r\n                                        }`}\r\n                                    onClick={() => setSelectedClass(cls.id)}\r\n                                >\r\n                                    <p className=\"font-medium text-gray-900\">{cls.name}</p>\r\n                                    <div className=\"flex items-center justify-between mt-2\">\r\n                                        <span className=\"text-xs text-gray-500\">\r\n                                            {assignments.length}/{subjects.length} subjects\r\n                                        </span>\r\n                                        <span className={`text-xs font-bold ${coverage >= 80 ? 'text-green-600' :\r\n                                            coverage >= 50 ? 'text-yellow-600' : 'text-red-600'\r\n                                            }`}>\r\n                                            {coverage}%\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"mt-2 h-1.5 bg-gray-200 rounded-full overflow-hidden\">\r\n                                        <div\r\n                                            className={`h-full rounded-full ${coverage >= 80 ? 'bg-green-500' :\r\n                                                coverage >= 50 ? 'bg-yellow-500' : 'bg-red-500'\r\n                                                }`}\r\n                                            style={{ width: `${coverage}%` }}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            </Card>\r\n        </div>\r\n    );\r\n};\r\n","'use client';\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { TrendingUp, TrendingDown, Minus, BarChart3 } from 'lucide-react';\r\nimport {\r\n    DynamicLineChart as LineChart,\r\n    DynamicBarChart as BarChart,\r\n    Line, Bar,\r\n    XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer\r\n} from '@/components/ui/charts';\r\nimport * as Types from '@/lib/types';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Select } from '@/components/ui/select';\r\n\r\ninterface TermComparisonViewProps {\r\n    students: Types.Student[];\r\n    classes: Types.Class[];\r\n    scores: Types.Score[];\r\n    settings: Types.Settings;\r\n}\r\n\r\nexport const TermComparisonView: React.FC<TermComparisonViewProps> = ({\r\n    students, classes, scores, settings\r\n}) => {\r\n    const [selectedClass, setSelectedClass] = useState(classes[0]?.id || '');\r\n    const [selectedStudent, setSelectedStudent] = useState('');\r\n    const [compareMode, setCompareMode] = useState<'student' | 'class'>('student');\r\n\r\n    const activeStudents = students.filter(s => s.class_id === selectedClass);\r\n    const terms = settings.terms || ['First Term', 'Second Term', 'Third Term'];\r\n\r\n    // Calculate student performance across terms\r\n    const studentTermData = useMemo(() => {\r\n        if (!selectedStudent) return [];\r\n\r\n        return terms.map(term => {\r\n            const score = scores.find(\r\n                s => s.student_id === selectedStudent &&\r\n                    s.session === settings.current_session &&\r\n                    s.term === term\r\n            );\r\n            return {\r\n                term: term.replace(' Term', ''),\r\n                average: score?.average || 0,\r\n                totalSubjects: score?.rows.length || 0,\r\n                totalScore: score?.total_score || 0\r\n            };\r\n        });\r\n    }, [selectedStudent, scores, settings.current_session, terms]);\r\n\r\n    // Calculate class average across terms\r\n    const classTermData = useMemo(() => {\r\n        const classStudents = students.filter(s => s.class_id === selectedClass);\r\n\r\n        return terms.map(term => {\r\n            const termScores = classStudents.map(student => {\r\n                const score = scores.find(\r\n                    s => s.student_id === student.id &&\r\n                        s.session === settings.current_session &&\r\n                        s.term === term\r\n                );\r\n                return score?.average || 0;\r\n            }).filter(avg => avg > 0);\r\n\r\n            const classAverage = termScores.length > 0\r\n                ? termScores.reduce((a, b) => a + b, 0) / termScores.length\r\n                : 0;\r\n\r\n            return {\r\n                term: term.replace(' Term', ''),\r\n                average: Math.round(classAverage * 100) / 100,\r\n                studentsWithScores: termScores.length\r\n            };\r\n        });\r\n    }, [selectedClass, students, scores, settings.current_session, terms]);\r\n\r\n    // Subject-wise comparison for student\r\n    const subjectComparison = useMemo(() => {\r\n        if (!selectedStudent) return [];\r\n\r\n        const allSubjects = new Set<string>();\r\n        const termScores: Record<string, Types.Score | undefined> = {};\r\n\r\n        terms.forEach(term => {\r\n            const score = scores.find(\r\n                s => s.student_id === selectedStudent &&\r\n                    s.session === settings.current_session &&\r\n                    s.term === term\r\n            );\r\n            termScores[term] = score;\r\n            score?.rows.forEach(row => allSubjects.add(row.subject));\r\n        });\r\n\r\n        return Array.from(allSubjects).map(subject => {\r\n            const data: Record<string, any> = { subject };\r\n            terms.forEach(term => {\r\n                const row = termScores[term]?.rows.find(r => r.subject === subject);\r\n                data[term.replace(' Term', '')] = row?.total || 0;\r\n            });\r\n            return data;\r\n        });\r\n    }, [selectedStudent, scores, settings.current_session, terms]);\r\n\r\n    // Calculate trend indicator\r\n    const getTrendIndicator = (data: { average: number }[]) => {\r\n        if (data.length < 2) return null;\r\n        const lastTwo = data.slice(-2);\r\n        const diff = lastTwo[1].average - lastTwo[0].average;\r\n\r\n        if (diff > 5) return { icon: TrendingUp, color: 'text-green-600', label: 'Improving' };\r\n        if (diff < -5) return { icon: TrendingDown, color: 'text-red-600', label: 'Declining' };\r\n        return { icon: Minus, color: 'text-gray-500', label: 'Stable' };\r\n    };\r\n\r\n    const studentTrend = getTrendIndicator(studentTermData);\r\n    const classTrend = getTrendIndicator(classTermData);\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold text-gray-900\">Term Progression Tracking</h2>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">Compare performance across terms</p>\r\n                </div>\r\n                <div className=\"flex bg-gray-100 p-1 rounded-lg\">\r\n                    <button\r\n                        onClick={() => setCompareMode('student')}\r\n                        className={`px-4 py-2 text-sm font-medium rounded-md ${compareMode === 'student' ? 'bg-white shadow text-brand-700' : 'text-gray-600'\r\n                            }`}\r\n                    >\r\n                        By Student\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setCompareMode('class')}\r\n                        className={`px-4 py-2 text-sm font-medium rounded-md ${compareMode === 'class' ? 'bg-white shadow text-brand-700' : 'text-gray-600'\r\n                            }`}\r\n                    >\r\n                        By Class\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n                {/* Selection Panel */}\r\n                <Card className=\"lg:col-span-1\">\r\n                    <div className=\"p-4 space-y-4\">\r\n                        <Select\r\n                            label=\"Class\"\r\n                            value={selectedClass}\r\n                            onChange={e => {\r\n                                setSelectedClass(e.target.value);\r\n                                setSelectedStudent('');\r\n                            }}\r\n                        >\r\n                            {classes.map(c => (\r\n                                <option key={c.id} value={c.id}>{c.name}</option>\r\n                            ))}\r\n                        </Select>\r\n\r\n                        {compareMode === 'student' && (\r\n                            <div className=\"space-y-1 max-h-[400px] overflow-y-auto border rounded-md\">\r\n                                {activeStudents.map(s => (\r\n                                    <button\r\n                                        key={s.id}\r\n                                        onClick={() => setSelectedStudent(s.id)}\r\n                                        className={`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${selectedStudent === s.id\r\n                                            ? 'bg-brand-50 text-brand-700 font-medium'\r\n                                            : 'text-gray-700'\r\n                                            }`}\r\n                                    >\r\n                                        {s.names}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {compareMode === 'student' && selectedStudent && studentTrend && (\r\n                            <div className={`p-3 rounded-lg bg-gray-50 flex items-center gap-2 ${studentTrend.color}`}>\r\n                                <studentTrend.icon className=\"h-5 w-5\" />\r\n                                <span className=\"text-sm font-medium\">{studentTrend.label}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {compareMode === 'class' && classTrend && (\r\n                            <div className={`p-3 rounded-lg bg-gray-50 flex items-center gap-2 ${classTrend.color}`}>\r\n                                <classTrend.icon className=\"h-5 w-5\" />\r\n                                <span className=\"text-sm font-medium\">Class is {classTrend.label}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </Card>\r\n\r\n                {/* Charts Panel */}\r\n                <div className=\"lg:col-span-3 space-y-6\">\r\n                    {/* Average Trend Line Chart */}\r\n                    <Card>\r\n                        <div className=\"p-4\">\r\n                            <h3 className=\"font-semibold text-gray-700 flex items-center gap-2 mb-4\">\r\n                                <BarChart3 className=\"h-4 w-4\" />\r\n                                {compareMode === 'student' ? 'Student Average Progression' : 'Class Average Progression'}\r\n                            </h3>\r\n\r\n                            {(compareMode === 'student' && !selectedStudent) ? (\r\n                                <div className=\"h-64 flex items-center justify-center text-gray-400\">\r\n                                    Select a student to view their progression\r\n                                </div>\r\n                            ) : (\r\n                                <ResponsiveContainer width=\"100%\" height={250}>\r\n                                    <LineChart data={compareMode === 'student' ? studentTermData : classTermData}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" />\r\n                                        <XAxis dataKey=\"term\" />\r\n                                        <YAxis domain={[0, 100]} />\r\n                                        <Tooltip />\r\n                                        <Legend />\r\n                                        <Line\r\n                                            type=\"monotone\"\r\n                                            dataKey=\"average\"\r\n                                            stroke=\"#16a34a\"\r\n                                            strokeWidth={3}\r\n                                            dot={{ r: 6 }}\r\n                                            name=\"Average (%)\"\r\n                                        />\r\n                                    </LineChart>\r\n                                </ResponsiveContainer>\r\n                            )}\r\n                        </div>\r\n                    </Card>\r\n\r\n                    {/* Subject-wise Comparison (Student Mode Only) */}\r\n                    {compareMode === 'student' && selectedStudent && subjectComparison.length > 0 && (\r\n                        <Card>\r\n                            <div className=\"p-4\">\r\n                                <h3 className=\"font-semibold text-gray-700 mb-4\">\r\n                                    Subject-wise Comparison\r\n                                </h3>\r\n                                <ResponsiveContainer width=\"100%\" height={300}>\r\n                                    <BarChart data={subjectComparison} layout=\"vertical\">\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" />\r\n                                        <XAxis type=\"number\" domain={[0, 100]} />\r\n                                        <YAxis type=\"category\" dataKey=\"subject\" width={100} />\r\n                                        <Tooltip />\r\n                                        <Legend />\r\n                                        {terms.map((term, index) => (\r\n                                            <Bar\r\n                                                key={term}\r\n                                                dataKey={term.replace(' Term', '')}\r\n                                                fill={['#16a34a', '#3b82f6', '#f59e0b'][index % 3]}\r\n                                                name={term}\r\n                                            />\r\n                                        ))}\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        </Card>\r\n                    )}\r\n\r\n                    {/* Term Summary Table */}\r\n                    <Card>\r\n                        <div className=\"p-4\">\r\n                            <h3 className=\"font-semibold text-gray-700 mb-4\">Term Summary</h3>\r\n                            <table className=\"w-full text-sm\">\r\n                                <thead className=\"bg-gray-50\">\r\n                                    <tr>\r\n                                        <th className=\"px-4 py-2 text-left\">Term</th>\r\n                                        <th className=\"px-4 py-2 text-center\">Average</th>\r\n                                        <th className=\"px-4 py-2 text-center\">\r\n                                            {compareMode === 'student' ? 'Subjects' : 'Students'}\r\n                                        </th>\r\n                                        <th className=\"px-4 py-2 text-center\">Change</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {(compareMode === 'student' ? studentTermData : classTermData).map((row, index, arr) => {\r\n                                        const prev = index > 0 ? arr[index - 1].average : 0;\r\n                                        const change = index > 0 ? row.average - prev : 0;\r\n\r\n                                        return (\r\n                                            <tr key={row.term} className=\"border-t\">\r\n                                                <td className=\"px-4 py-3 font-medium\">{row.term} Term</td>\r\n                                                <td className=\"px-4 py-3 text-center\">\r\n                                                    <span className={`font-bold ${row.average >= 50 ? 'text-green-600' : 'text-red-600'\r\n                                                        }`}>\r\n                                                        {row.average.toFixed(1)}%\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-center text-gray-500\">\r\n                                                    {compareMode === 'student'\r\n                                                        ? (row as any).totalSubjects\r\n                                                        : (row as any).studentsWithScores\r\n                                                    }\r\n                                                </td>\r\n                                                <td className=\"px-4 py-3 text-center\">\r\n                                                    {index > 0 && (\r\n                                                        <span className={`font-medium ${change > 0 ? 'text-green-600' :\r\n                                                            change < 0 ? 'text-red-600' : 'text-gray-500'\r\n                                                            }`}>\r\n                                                            {change > 0 ? '+' : ''}{change.toFixed(1)}%\r\n                                                        </span>\r\n                                                    )}\r\n                                                </td>\r\n                                            </tr>\r\n                                        );\r\n                                    })}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </Card>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","'use client';\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { ArrowUp, Check, X, AlertCircle, Save, RefreshCw } from 'lucide-react';\r\nimport { useSchoolStore } from '@/lib/store';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select } from '@/components/ui/select';\r\nimport { Input } from '@/components/ui/input';\r\nimport { useToast } from '@/components/providers/toast-provider';\r\nimport * as Utils from '@/lib/utils';\r\nimport * as Types from '@/lib/types';\r\nimport {\r\n    useStudents, useClasses, useScores, useSettings, useUpdateSettings, useUpdateScore\r\n} from '@/lib/hooks/use-data';\r\n\r\nexport const PromotionManager: React.FC = () => {\r\n    // Auth\r\n    const { addToast } = useToast();\r\n\r\n    // Data Hooks\r\n    const { data: students = [] } = useStudents();\r\n    const { data: classes = [] } = useClasses();\r\n    const { data: scores = [] } = useScores();\r\n    const { data: settings = Utils.INITIAL_SETTINGS } = useSettings();\r\n\r\n    // Mutations\r\n    const { mutate: updateSettings } = useUpdateSettings();\r\n    const { mutate: updateScore } = useUpdateScore();\r\n    const setSettings = (newSettings: Types.Settings) => updateSettings(newSettings); // Adapter for state setter style\r\n\r\n    const [selectedClass, setSelectedClass] = useState(classes[0]?.id || '');\r\n    const [localThreshold, setLocalThreshold] = useState(settings.promotion_threshold);\r\n    const [promotionResults, setPromotionResults] = useState<Map<string, string | null>>(new Map());\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n    const currentClass = classes.find(c => c.id === selectedClass);\r\n    const nextClass = classes.find((c, i) => {\r\n        const currentIndex = classes.findIndex(cl => cl.id === selectedClass);\r\n        return i === currentIndex + 1;\r\n    });\r\n\r\n    const activeStudents = students.filter((s: Types.Student) => s.class_id === selectedClass);\r\n\r\n    // Calculate student averages for promotion eligibility\r\n    const studentStats = useMemo(() => {\r\n        return activeStudents.map((student: Types.Student) => {\r\n            // Get scores from all terms in current session\r\n            const termScores = scores.filter(\r\n                (s: Types.Score) => s.student_id === student.id && s.session === settings.current_session\r\n            );\r\n\r\n            // Calculate overall average across all terms\r\n            const allAverages = termScores.map((s: Types.Score) => s.average).filter((a: number) => a > 0);\r\n            const overallAverage = allAverages.length > 0\r\n                ? allAverages.reduce((a: number, b: number) => a + b, 0) / allAverages.length\r\n                : 0;\r\n\r\n            // Get position in class\r\n            const position = Utils.getStudentPosition(\r\n                student.id, students, scores, settings.current_session, settings.current_term\r\n            );\r\n\r\n            return {\r\n                student,\r\n                average: Math.round(overallAverage * 100) / 100,\r\n                termsWithScores: allAverages.length,\r\n                position,\r\n                eligible: overallAverage >= localThreshold,\r\n                promotedTo: promotionResults.get(student.id) || null\r\n            };\r\n        }).sort((a: any, b: any) => b.average - a.average);\r\n    }, [activeStudents, scores, settings, localThreshold, promotionResults]);\r\n\r\n    const eligibleCount = studentStats.filter((s: any) => s.eligible).length;\r\n    const processedCount = studentStats.filter((s: any) => s.promotedTo !== null).length;\r\n\r\n    const handleRunPromotion = () => {\r\n        if (!nextClass) {\r\n            addToast('No next class available for promotion', 'warning');\r\n            return;\r\n        }\r\n\r\n        setIsProcessing(true);\r\n        const results = new Map<string, string | null>();\r\n\r\n        studentStats.forEach((stat: any) => {\r\n            if (stat.eligible) {\r\n                results.set(stat.student.id, nextClass.id);\r\n            } else {\r\n                results.set(stat.student.id, selectedClass); // Repeat class\r\n            }\r\n        });\r\n\r\n        setPromotionResults(results);\r\n        setIsProcessing(false);\r\n        addToast(`Processed ${studentStats.length} students`, 'success');\r\n    };\r\n\r\n    const handleTogglePromotion = (studentId: string) => {\r\n        if (!nextClass) return;\r\n\r\n        const current = promotionResults.get(studentId);\r\n        const newResults = new Map(promotionResults);\r\n\r\n        if (current === nextClass.id) {\r\n            newResults.set(studentId, selectedClass); // Demote to repeat\r\n        } else {\r\n            newResults.set(studentId, nextClass.id); // Promote\r\n        }\r\n\r\n        setPromotionResults(newResults);\r\n    };\r\n\r\n    const handleSavePromotions = () => {\r\n        // Update ONLY the Score records that have a specific promotion result\r\n        let updateCount = 0;\r\n\r\n        scores.forEach(score => {\r\n            const promotedTo = promotionResults.get(score.student_id);\r\n            // If student has a promotion result, and this score is for the current session (to record promotion status)\r\n            // And the status is actually new/different\r\n            if (promotedTo && score.session === settings.current_session && score.promoted_to !== promotedTo) {\r\n                updateScore({ id: score.id, updates: { promoted_to: promotedTo } });\r\n                updateCount++;\r\n            }\r\n        });\r\n\r\n        if (updateCount > 0) {\r\n            addToast(`Promotions saved for ${updateCount} student records`, 'success');\r\n        } else {\r\n            addToast('No changes to save', 'info');\r\n        }\r\n    };\r\n\r\n    const handleSaveThreshold = () => {\r\n        setSettings({ ...settings, promotion_threshold: localThreshold });\r\n        addToast(`Threshold updated to ${localThreshold}%`, 'success');\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold text-gray-900\">Promotion Engine</h2>\r\n                    <p className=\"text-sm text-gray-500 mt-1\">\r\n                        Manage end-of-session student promotions\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-sm text-gray-500\">Threshold:</span>\r\n                        <Input\r\n                            type=\"number\"\r\n                            value={localThreshold}\r\n                            onChange={e => setLocalThreshold(parseInt(e.target.value) || 0)}\r\n                            min={0}\r\n                            max={100}\r\n                            className=\"w-20\"\r\n                        />\r\n                        <span className=\"text-sm text-gray-500\">%</span>\r\n                        {localThreshold !== settings.promotion_threshold && (\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={handleSaveThreshold}>\r\n                                <Save className=\"h-3 w-3 mr-1\" />\r\n                                Save\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n                {/* Stats Cards */}\r\n                <Card className=\"bg-gradient-to-br from-brand-50 to-white\">\r\n                    <div className=\"p-4 text-center\">\r\n                        <p className=\"text-sm text-gray-500\">Total Students</p>\r\n                        <p className=\"text-3xl font-bold text-gray-900\">{studentStats.length}</p>\r\n                    </div>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-green-50 to-white\">\r\n                    <div className=\"p-4 text-center\">\r\n                        <p className=\"text-sm text-gray-500\">Eligible for Promotion</p>\r\n                        <p className=\"text-3xl font-bold text-green-600\">{eligibleCount}</p>\r\n                    </div>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-red-50 to-white\">\r\n                    <div className=\"p-4 text-center\">\r\n                        <p className=\"text-sm text-gray-500\">To Repeat</p>\r\n                        <p className=\"text-3xl font-bold text-red-600\">{studentStats.length - eligibleCount}</p>\r\n                    </div>\r\n                </Card>\r\n                <Card className=\"bg-gradient-to-br from-blue-50 to-white\">\r\n                    <div className=\"p-4 text-center\">\r\n                        <p className=\"text-sm text-gray-500\">Processed</p>\r\n                        <p className=\"text-3xl font-bold text-blue-600\">{processedCount}</p>\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\r\n                {/* Class Selection */}\r\n                <Card className=\"lg:col-span-1\">\r\n                    <div className=\"p-4 space-y-4\">\r\n                        <Select\r\n                            label=\"Select Class\"\r\n                            value={selectedClass}\r\n                            onChange={e => {\r\n                                setSelectedClass(e.target.value);\r\n                                setPromotionResults(new Map());\r\n                            }}\r\n                        >\r\n                            {classes.map(c => (\r\n                                <option key={c.id} value={c.id}>{c.name}</option>\r\n                            ))}\r\n                        </Select>\r\n\r\n                        <div className=\"p-3 bg-gray-50 rounded-lg space-y-2 text-sm\">\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">From:</span>\r\n                                <span className=\"font-medium\">{currentClass?.name}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-gray-500\">To:</span>\r\n                                <span className=\"font-medium text-brand-600\">\r\n                                    {nextClass?.name || 'N/A (Final Class)'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <Button\r\n                            className=\"w-full\"\r\n                            onClick={handleRunPromotion}\r\n                            disabled={isProcessing || !nextClass}\r\n                        >\r\n                            <RefreshCw className={`h-4 w-4 mr-2 ${isProcessing ? 'animate-spin' : ''}`} />\r\n                            Run Auto-Promotion\r\n                        </Button>\r\n\r\n                        {processedCount > 0 && (\r\n                            <Button\r\n                                className=\"w-full\"\r\n                                variant=\"outline\"\r\n                                onClick={handleSavePromotions}\r\n                            >\r\n                                <Save className=\"h-4 w-4 mr-2\" />\r\n                                Save Promotions\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n                </Card>\r\n\r\n                {/* Student List */}\r\n                <Card className=\"lg:col-span-3\">\r\n                    <div className=\"p-4\">\r\n                        <h3 className=\"font-semibold text-gray-700 mb-4\">\r\n                            Students in {currentClass?.name}\r\n                        </h3>\r\n\r\n                        <table className=\"w-full text-sm\">\r\n                            <thead className=\"bg-gray-50\">\r\n                                <tr>\r\n                                    <th className=\"px-4 py-2 text-left\">Student</th>\r\n                                    <th className=\"px-4 py-2 text-center\">Average</th>\r\n                                    <th className=\"px-4 py-2 text-center\">Position</th>\r\n                                    <th className=\"px-4 py-2 text-center\">Status</th>\r\n                                    <th className=\"px-4 py-2 text-center\">Action</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {studentStats.map((stat: any) => {\r\n                                    const isPromoted = stat.promotedTo === nextClass?.id;\r\n\r\n                                    return (\r\n                                        <tr key={stat.student.id} className=\"border-t\">\r\n                                            <td className=\"px-4 py-3\">\r\n                                                <div>\r\n                                                    <p className=\"font-medium text-gray-900\">{stat.student.names}</p>\r\n                                                    <p className=\"text-xs text-gray-500\">{stat.student.student_no}</p>\r\n                                                </div>\r\n                                            </td>\r\n                                            <td className=\"px-4 py-3 text-center\">\r\n                                                <span className={`font-bold ${stat.eligible ? 'text-green-600' : 'text-red-600'\r\n                                                    }`}>\r\n                                                    {stat.average.toFixed(1)}%\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-4 py-3 text-center\">\r\n                                                {stat.position ? Utils.ordinalSuffix(stat.position) : '-'}\r\n                                            </td>\r\n                                            <td className=\"px-4 py-3 text-center\">\r\n                                                {stat.promotedTo ? (\r\n                                                    <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${isPromoted\r\n                                                        ? 'bg-green-100 text-green-700'\r\n                                                        : 'bg-red-100 text-red-700'\r\n                                                        }`}>\r\n                                                        {isPromoted ? (\r\n                                                            <><ArrowUp className=\"h-3 w-3\" /> Promoted</>\r\n                                                        ) : (\r\n                                                            <><X className=\"h-3 w-3\" /> Repeat</>\r\n                                                        )}\r\n                                                    </span>\r\n                                                ) : (\r\n                                                    <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600\">\r\n                                                        {stat.eligible ? (\r\n                                                            <><Check className=\"h-3 w-3\" /> Eligible</>\r\n                                                        ) : (\r\n                                                            <><AlertCircle className=\"h-3 w-3\" /> Below Threshold</>\r\n                                                        )}\r\n                                                    </span>\r\n                                                )}\r\n                                            </td>\r\n                                            <td className=\"px-4 py-3 text-center\">\r\n                                                {stat.promotedTo && nextClass && (\r\n                                                    <button\r\n                                                        onClick={() => handleTogglePromotion(stat.student.id)}\r\n                                                        className={`text-xs px-2 py-1 rounded ${isPromoted\r\n                                                            ? 'text-red-600 hover:bg-red-50'\r\n                                                            : 'text-green-600 hover:bg-green-50'\r\n                                                            }`}\r\n                                                    >\r\n                                                        {isPromoted ? 'Set to Repeat' : 'Promote'}\r\n                                                    </button>\r\n                                                )}\r\n                                            </td>\r\n                                        </tr>\r\n                                    );\r\n                                })}\r\n\r\n                                {studentStats.length === 0 && (\r\n                                    <tr>\r\n                                        <td colSpan={5} className=\"px-4 py-8 text-center text-gray-500\">\r\n                                            No students in this class\r\n                                        </td>\r\n                                    </tr>\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","'use client';\r\n\r\nimport React, { useMemo } from 'react';\r\nimport { ClipboardList, Award, TrendingUp, BookOpen } from 'lucide-react';\r\nimport * as Types from '@/lib/types';\r\nimport * as Utils from '@/lib/utils';\r\nimport { Card } from '@/components/ui/card';\r\n\r\ninterface StudentScoresViewProps {\r\n    student: Types.Student;\r\n    students: Types.Student[];\r\n    currentClass?: Types.Class;\r\n    scores: Types.Score[];\r\n    settings: Types.Settings;\r\n}\r\n\r\nexport const StudentScoresView: React.FC<StudentScoresViewProps> = ({\r\n    student, students, currentClass, scores, settings\r\n}) => {\r\n    // Get current term scores\r\n    const myScore = useMemo(() => {\r\n        return scores.find(s =>\r\n            s.student_id === student.id &&\r\n            s.session === settings.current_session &&\r\n            s.term === settings.current_term\r\n        );\r\n    }, [scores, student.id, settings]);\r\n\r\n    // Calculate position\r\n    const position = useMemo(() => {\r\n        if (!myScore) return null;\r\n        return Utils.getStudentPosition(student.id, students, scores, settings.current_session, settings.current_term);\r\n    }, [student.id, students, scores, settings, myScore]);\r\n\r\n    const totalInClass = useMemo(() => {\r\n        return students.filter(s => s.class_id === student.class_id).length;\r\n    }, [students, student.class_id]);\r\n\r\n    const classSubjects = Utils.getSubjectsForClass(currentClass);\r\n\r\n    const getGradeColor = (grade: string) => {\r\n        switch (grade) {\r\n            case 'A': return 'bg-green-100 text-green-700';\r\n            case 'B': return 'bg-blue-100 text-blue-700';\r\n            case 'C': return 'bg-yellow-100 text-yellow-700';\r\n            case 'D': return 'bg-orange-100 text-orange-700';\r\n            case 'E':\r\n            case 'F': return 'bg-red-100 text-red-700';\r\n            default: return 'bg-gray-100 text-gray-700';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">My Academic Scores</h1>\r\n                <p className=\"text-gray-500\">View your scores for {settings.current_term} - {settings.current_session}</p>\r\n            </div>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                <Card className=\"p-4 bg-gradient-to-br from-brand-500 to-brand-600 text-white\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"h-10 w-10 bg-white/20 rounded-lg flex items-center justify-center\">\r\n                            <TrendingUp className=\"h-5 w-5\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-3xl font-bold\">{myScore?.average?.toFixed(1) || '0'}%</p>\r\n                            <p className=\"text-xs text-white/80\">Term Average</p>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n\r\n                <Card className=\"p-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"h-10 w-10 bg-amber-100 rounded-lg flex items-center justify-center\">\r\n                            <Award className=\"h-5 w-5 text-amber-600\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">{position ? Utils.ordinalSuffix(position) : '-'}</p>\r\n                            <p className=\"text-xs text-gray-500\">Class Position</p>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n\r\n                <Card className=\"p-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"h-10 w-10 bg-purple-100 rounded-lg flex items-center justify-center\">\r\n                            <BookOpen className=\"h-5 w-5 text-purple-600\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">{myScore?.rows?.length || 0}</p>\r\n                            <p className=\"text-xs text-gray-500\">Subjects</p>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n\r\n                <Card className=\"p-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center\">\r\n                            <ClipboardList className=\"h-5 w-5 text-green-600\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-gray-900\">{totalInClass}</p>\r\n                            <p className=\"text-xs text-gray-500\">Students in Class</p>\r\n                        </div>\r\n                    </div>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Scores Table */}\r\n            <Card className=\"p-6\">\r\n                <h2 className=\"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2\">\r\n                    <ClipboardList className=\"h-5 w-5 text-brand-500\" />\r\n                    Subject Scores\r\n                </h2>\r\n\r\n                {myScore && myScore.rows.length > 0 ? (\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full\">\r\n                            <thead>\r\n                                <tr className=\"border-b-2 border-gray-200\">\r\n                                    <th className=\"text-left py-3 px-4 font-bold text-gray-700\">Subject</th>\r\n                                    <th className=\"text-center py-3 px-4 font-bold text-gray-700\">CA1 (15)</th>\r\n                                    <th className=\"text-center py-3 px-4 font-bold text-gray-700\">CA2 (15)</th>\r\n                                    <th className=\"text-center py-3 px-4 font-bold text-gray-700\">Exam (70)</th>\r\n                                    <th className=\"text-center py-3 px-4 font-bold text-gray-700\">Total (100)</th>\r\n                                    <th className=\"text-center py-3 px-4 font-bold text-gray-700\">Grade</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {myScore.rows.map((row, i) => (\r\n                                    <tr key={i} className=\"border-b border-gray-100 hover:bg-gray-50\">\r\n                                        <td className=\"py-3 px-4 font-medium text-gray-900\">{row.subject}</td>\r\n                                        <td className=\"py-3 px-4 text-center text-gray-600\">{row.ca1}</td>\r\n                                        <td className=\"py-3 px-4 text-center text-gray-600\">{row.ca2}</td>\r\n                                        <td className=\"py-3 px-4 text-center text-gray-600\">{row.exam}</td>\r\n                                        <td className=\"py-3 px-4 text-center font-bold text-gray-900\">{row.total}</td>\r\n                                        <td className=\"py-3 px-4 text-center\">\r\n                                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${getGradeColor(row.grade)}`}>\r\n                                                {row.grade}\r\n                                            </span>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                            <tfoot>\r\n                                <tr className=\"bg-gray-50 font-bold\">\r\n                                    <td className=\"py-3 px-4 text-gray-900\">Overall Average</td>\r\n                                    <td className=\"py-3 px-4 text-center\" colSpan={3}></td>\r\n                                    <td className=\"py-3 px-4 text-center text-brand-600 text-lg\">{myScore.average?.toFixed(1)}%</td>\r\n                                    <td className=\"py-3 px-4 text-center\">\r\n                                        <span className={`px-3 py-1 rounded-full text-sm font-bold ${getGradeColor(myScore.rows[0]?.grade || 'C')}`}>\r\n                                            {myScore.average && myScore.average >= 70 ? 'A' : myScore.average && myScore.average >= 60 ? 'B' : myScore.average && myScore.average >= 50 ? 'C' : myScore.average && myScore.average >= 45 ? 'D' : 'F'}\r\n                                        </span>\r\n                                    </td>\r\n                                </tr>\r\n                            </tfoot>\r\n                        </table>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"text-center py-12 text-gray-400\">\r\n                        <ClipboardList className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\r\n                        <p className=\"italic\">No scores available for this term yet.</p>\r\n                        <p className=\"text-sm mt-2\">Check back later for your results.</p>\r\n                    </div>\r\n                )}\r\n            </Card>\r\n\r\n            {/* Teacher's Remarks */}\r\n            {myScore && (myScore.teacher_remark || myScore.head_teacher_remark) && (\r\n                <Card className=\"p-6\">\r\n                    <h2 className=\"text-lg font-bold text-gray-900 mb-4\">Remarks</h2>\r\n                    <div className=\"space-y-4\">\r\n                        {myScore.teacher_remark && (\r\n                            <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-100\">\r\n                                <p className=\"text-xs font-bold text-blue-600 uppercase mb-1\">Class Teacher's Remark</p>\r\n                                <p className=\"text-gray-700\">{myScore.teacher_remark}</p>\r\n                            </div>\r\n                        )}\r\n                        {myScore.head_teacher_remark && (\r\n                            <div className=\"p-4 bg-purple-50 rounded-lg border border-purple-100\">\r\n                                <p className=\"text-xs font-bold text-purple-600 uppercase mb-1\">Principal's Remark</p>\r\n                                <p className=\"text-gray-700\">{myScore.head_teacher_remark}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </Card>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","'use client';\r\nimport { useState, useMemo } from 'react';\r\nimport { useSchoolStore } from '@/lib/store';\r\nimport {\r\n    useStudents, useClasses, useScores, useSettings,\r\n    useCreateScore, useUpdateScore\r\n} from '@/lib/hooks/use-data';\r\nimport * as Utils from '@/lib/utils';\r\nimport * as Types from '@/lib/types';\r\nimport { GradingView } from '@/components/features/GradingView';\r\nimport { SubjectTeacherManager } from '@/components/features/grading/SubjectTeacherManager';\r\nimport { TermComparisonView } from '@/components/features/grading/TermComparisonView';\r\nimport { PromotionManager } from '@/components/features/grading/PromotionManager';\r\nimport { StudentScoresView } from '@/components/features/grading/StudentScoresView';\r\n\r\nexport default function GradingPage() {\r\n    const { currentRole, currentUser } = useSchoolStore();\r\n\r\n    // Data Hooks\r\n    const { data: students = [] } = useStudents();\r\n    const { data: classes = [] } = useClasses();\r\n    const { data: scores = [] } = useScores();\r\n    const { data: settings = Utils.INITIAL_SETTINGS } = useSettings();\r\n\r\n    // Mutations\r\n    const { mutate: createScore } = useCreateScore();\r\n    const { mutate: updateScore } = useUpdateScore();\r\n\r\n    const [activeTab, setActiveTab] = useState<'grading' | 'comparison' | 'promotion' | 'assignments'>('grading');\r\n\r\n    // Handle single score update from GradingView\r\n    const handleUpsertScore = (score: Types.Score) => {\r\n        // Check if score exists in our loaded data (by ID)\r\n        // Note: GradingView generates IDs for new scores locally\r\n        // We can check if the ID exists in the fetched database scores\r\n        const existing = scores.find(s => s.id === score.id);\r\n\r\n        if (existing) {\r\n            updateScore({ id: score.id, updates: score });\r\n        } else {\r\n            createScore(score);\r\n        }\r\n    };\r\n\r\n\r\n    // Check if student/parent role\r\n    const isStudentOrParent = currentRole === 'student' || currentRole === 'parent';\r\n\r\n    // Get student for student/parent role\r\n    const student = useMemo(() => {\r\n        if (!isStudentOrParent) return null;\r\n        const studentId = currentUser?.student_id || students[0]?.id;\r\n        return students.find((s: Types.Student) => s.id === studentId) || students[0];\r\n    }, [isStudentOrParent, currentUser, students]);\r\n\r\n    const currentClass = student ? classes.find((c: Types.Class) => c.id === student.class_id) : undefined;\r\n\r\n    // Render student-specific view for student/parent roles\r\n    if (isStudentOrParent && student) {\r\n        return (\r\n            <StudentScoresView\r\n                student={student}\r\n                students={students}\r\n                currentClass={currentClass}\r\n                scores={scores}\r\n                settings={settings}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Tab Navigation */}\r\n            <div className=\"flex bg-gray-100 p-1 rounded-lg w-fit no-print\">\r\n                <button\r\n                    onClick={() => setActiveTab('grading')}\r\n                    className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${activeTab === 'grading' ? 'bg-white shadow text-brand-700' : 'text-gray-600 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    Score Entry\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('comparison')}\r\n                    className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${activeTab === 'comparison' ? 'bg-white shadow text-brand-700' : 'text-gray-600 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    Term Comparison\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('promotion')}\r\n                    className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${activeTab === 'promotion' ? 'bg-white shadow text-brand-700' : 'text-gray-600 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    Promotions\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('assignments')}\r\n                    className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${activeTab === 'assignments' ? 'bg-white shadow text-brand-700' : 'text-gray-600 hover:text-gray-900'\r\n                        }`}\r\n                >\r\n                    Subject Teachers\r\n                </button>\r\n            </div>\r\n\r\n            {/* Tab Content */}\r\n            {activeTab === 'grading' && (\r\n                <GradingView\r\n                    students={students}\r\n                    classes={classes}\r\n                    scores={scores}\r\n                    settings={settings}\r\n                    onUpsertScore={handleUpsertScore}\r\n                />\r\n            )}\r\n\r\n            {activeTab === 'comparison' && (\r\n                <TermComparisonView\r\n                    students={students}\r\n                    classes={classes}\r\n                    scores={scores}\r\n                    settings={settings}\r\n                />\r\n            )}\r\n\r\n            {activeTab === 'promotion' && (\r\n                <PromotionManager />\r\n            )}\r\n\r\n            {activeTab === 'assignments' && (\r\n                <SubjectTeacherManager />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M5 12h14', key: '1ays0h' }]];\n\n/**\n * @component @name Minus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/minus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Minus = createLucideIcon('minus', __iconNode);\n\nexport default Minus;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'M20 6 9 17l-5-5', key: '1gmf2c' }]];\n\n/**\n * @component @name Check\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgNiA5IDE3bC01LTUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/check\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Check = createLucideIcon('check', __iconNode);\n\nexport default Check;\n"],"names":[],"mappings":"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","ignoreList":[5,6]}