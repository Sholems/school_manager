module.exports=[53999,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68515),e=a.i(91016),f=a.i(97895),g=a.i(76332),h=a.i(15618),i=a.i(81560),j=a.i(46864),k=a.i(53722),l=a.i(3130),m=a.i(40695),n=a.i(87682),o=a.i(49679);let p=()=>{let{addToast:a}=(0,o.useToast)(),{data:d=[]}=(0,e.useClasses)(),{data:g=[]}=(0,e.useTeachers)(),{data:p=[]}=(0,e.useSubjectTeachers)(),{data:q=f.INITIAL_SETTINGS}=(0,e.useSettings)(),{mutate:r}=(0,e.useCreateSubjectTeacher)(),{mutate:s}=(0,e.useDeleteSubjectTeacher)(),[t,u]=(0,c.useState)(d[0]?.id||""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),z=d.find(a=>a.id===t),A=f.getSubjectsForClass(z),B=p.filter(a=>a.class_id===t&&a.session===q.current_session),C=A.filter(a=>!B.some(b=>b.subject===a));return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Subject-Teacher Assignments"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Assign teachers to subjects for each class"})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)(l.Card,{className:"lg:col-span-1",children:(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4"}),"New Assignment"]}),(0,b.jsx)(n.Select,{label:"Class",value:t,onChange:a=>u(a.target.value),children:d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))}),(0,b.jsxs)(n.Select,{label:"Subject",value:x,onChange:a=>y(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Select Subject --"}),C.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsxs)(n.Select,{label:"Teacher",value:v,onChange:a=>w(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"-- Select Teacher --"}),g.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsxs)(m.Button,{className:"w-full",onClick:()=>{v&&x?B.some(a=>a.subject===x)?a("This subject is already assigned to a teacher","error"):(r({id:f.generateId(),teacher_id:v,class_id:t,subject:x,session:q.current_session,created_at:Date.now(),updated_at:Date.now()}),a("Subject-teacher assignment added","success"),y(""),w("")):a("Please select both a teacher and a subject","warning")},disabled:!v||!x,children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4 mr-2"}),"Add Assignment"]})]})}),(0,b.jsx)(l.Card,{className:"lg:col-span-2",children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-700 flex items-center gap-2 mb-4",children:[(0,b.jsx)(j.UserCheck,{className:"h-4 w-4"}),"Current Assignments for ",z?.name||"Class"]}),0===B.length?(0,b.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,b.jsx)(k.BookOpen,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No subject-teacher assignments yet"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:"Use the form on the left to add assignments"})]}):(0,b.jsx)("div",{className:"space-y-2",children:B.map(c=>{let d;return(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-brand-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(k.BookOpen,{className:"h-5 w-5 text-brand-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:c.subject}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Taught by: ",(d=c.teacher_id,g.find(a=>a.id===d)?.name||"Unknown")]})]})]}),(0,b.jsx)("button",{onClick:()=>{s(c.id),a("Assignment removed","info")},className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:(0,b.jsx)(i.Trash2,{className:"h-4 w-4"})})]},c.id)})})]})})]}),(0,b.jsx)(l.Card,{children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-700 mb-4",children:"Assignment Summary by Class"}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:d.map(a=>{let c=p.filter(b=>b.class_id===a.id&&b.session===q.current_session),d=f.getSubjectsForClass(a),e=d.length>0?Math.round(c.length/d.length*100):0;return(0,b.jsxs)("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${t===a.id?"bg-brand-50 border-brand-200":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>u(a.id),children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:[c.length,"/",d.length," subjects"]}),(0,b.jsxs)("span",{className:`text-xs font-bold ${e>=80?"text-green-600":e>=50?"text-yellow-600":"text-red-600"}`,children:[e,"%"]})]}),(0,b.jsx)("div",{className:"mt-2 h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full rounded-full ${e>=80?"bg-green-500":e>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${e}%`}})})]},a.id)})})]})})]})};var q=a.i(24669),r=a.i(53277),s=a.i(70106);let t=(0,s.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var u=a.i(39761),v=a.i(76912),w=a.i(77924),x=a.i(23665),y=a.i(58042),z=a.i(94222),A=a.i(54419),B=a.i(59854),C=a.i(2274),D=a.i(48662);let E=({students:a,classes:d,scores:e,settings:f})=>{let[g,h]=(0,c.useState)(d[0]?.id||""),[i,j]=(0,c.useState)(""),[k,m]=(0,c.useState)("student"),o=a.filter(a=>a.class_id===g),p=f.terms||["First Term","Second Term","Third Term"],s=(0,c.useMemo)(()=>i?p.map(a=>{let b=e.find(b=>b.student_id===i&&b.session===f.current_session&&b.term===a);return{term:a.replace(" Term",""),average:b?.average||0,totalSubjects:b?.rows.length||0,totalScore:b?.total_score||0}}):[],[i,e,f.current_session,p]),E=(0,c.useMemo)(()=>{let b=a.filter(a=>a.class_id===g);return p.map(a=>{let c=b.map(b=>{let c=e.find(c=>c.student_id===b.id&&c.session===f.current_session&&c.term===a);return c?.average||0}).filter(a=>a>0),d=c.length>0?c.reduce((a,b)=>a+b,0)/c.length:0;return{term:a.replace(" Term",""),average:Math.round(100*d)/100,studentsWithScores:c.length}})},[g,a,e,f.current_session,p]),F=(0,c.useMemo)(()=>{if(!i)return[];let a=new Set,b={};return p.forEach(c=>{let d=e.find(a=>a.student_id===i&&a.session===f.current_session&&a.term===c);b[c]=d,d?.rows.forEach(b=>a.add(b.subject))}),Array.from(a).map(a=>{let c={subject:a};return p.forEach(d=>{let e=b[d]?.rows.find(b=>b.subject===a);c[d.replace(" Term","")]=e?.total||0}),c})},[i,e,f.current_session,p]),G=a=>{if(a.length<2)return null;let b=a.slice(-2),c=b[1].average-b[0].average;return c>5?{icon:q.TrendingUp,color:"text-green-600",label:"Improving"}:c<-5?{icon:r.TrendingDown,color:"text-red-600",label:"Declining"}:{icon:t,color:"text-gray-500",label:"Stable"}},H=G(s),I=G(E);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Term Progression Tracking"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Compare performance across terms"})]}),(0,b.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[(0,b.jsx)("button",{onClick:()=>m("student"),className:`px-4 py-2 text-sm font-medium rounded-md ${"student"===k?"bg-white shadow text-brand-700":"text-gray-600"}`,children:"By Student"}),(0,b.jsx)("button",{onClick:()=>m("class"),className:`px-4 py-2 text-sm font-medium rounded-md ${"class"===k?"bg-white shadow text-brand-700":"text-gray-600"}`,children:"By Class"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)(l.Card,{className:"lg:col-span-1",children:(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsx)(n.Select,{label:"Class",value:g,onChange:a=>{h(a.target.value),j("")},children:d.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))}),"student"===k&&(0,b.jsx)("div",{className:"space-y-1 max-h-[400px] overflow-y-auto border rounded-md",children:o.map(a=>(0,b.jsx)("button",{onClick:()=>j(a.id),className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 ${i===a.id?"bg-brand-50 text-brand-700 font-medium":"text-gray-700"}`,children:a.names},a.id))}),"student"===k&&i&&H&&(0,b.jsxs)("div",{className:`p-3 rounded-lg bg-gray-50 flex items-center gap-2 ${H.color}`,children:[(0,b.jsx)(H.icon,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:H.label})]}),"class"===k&&I&&(0,b.jsxs)("div",{className:`p-3 rounded-lg bg-gray-50 flex items-center gap-2 ${I.color}`,children:[(0,b.jsx)(I.icon,{className:"h-5 w-5"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:["Class is ",I.label]})]})]})}),(0,b.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:[(0,b.jsx)(l.Card,{children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-700 flex items-center gap-2 mb-4",children:[(0,b.jsx)(u.BarChart3,{className:"h-4 w-4"}),"student"===k?"Student Average Progression":"Class Average Progression"]}),"student"!==k||i?(0,b.jsx)(D.ResponsiveContainer,{width:"100%",height:250,children:(0,b.jsxs)(v.DynamicLineChart,{data:"student"===k?s:E,children:[(0,b.jsx)(A.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(y.XAxis,{dataKey:"term"}),(0,b.jsx)(z.YAxis,{domain:[0,100]}),(0,b.jsx)(B.Tooltip,{}),(0,b.jsx)(C.Legend,{}),(0,b.jsx)(w.Line,{type:"monotone",dataKey:"average",stroke:"#16a34a",strokeWidth:3,dot:{r:6},name:"Average (%)"})]})}):(0,b.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-400",children:"Select a student to view their progression"})]})}),"student"===k&&i&&F.length>0&&(0,b.jsx)(l.Card,{children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-700 mb-4",children:"Subject-wise Comparison"}),(0,b.jsx)(D.ResponsiveContainer,{width:"100%",height:300,children:(0,b.jsxs)(v.DynamicBarChart,{data:F,layout:"vertical",children:[(0,b.jsx)(A.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(y.XAxis,{type:"number",domain:[0,100]}),(0,b.jsx)(z.YAxis,{type:"category",dataKey:"subject",width:100}),(0,b.jsx)(B.Tooltip,{}),(0,b.jsx)(C.Legend,{}),p.map((a,c)=>(0,b.jsx)(x.Bar,{dataKey:a.replace(" Term",""),fill:["#16a34a","#3b82f6","#f59e0b"][c%3],name:a},a))]})})]})}),(0,b.jsx)(l.Card,{children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-700 mb-4",children:"Term Summary"}),(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Term"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Average"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"student"===k?"Subjects":"Students"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Change"})]})}),(0,b.jsx)("tbody",{children:("student"===k?s:E).map((a,c,d)=>{let e=c>0?d[c-1].average:0,f=c>0?a.average-e:0;return(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsxs)("td",{className:"px-4 py-3 font-medium",children:[a.term," Term"]}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:(0,b.jsxs)("span",{className:`font-bold ${a.average>=50?"text-green-600":"text-red-600"}`,children:[a.average.toFixed(1),"%"]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-center text-gray-500",children:"student"===k?a.totalSubjects:a.studentsWithScores}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:c>0&&(0,b.jsxs)("span",{className:`font-medium ${f>0?"text-green-600":f<0?"text-red-600":"text-gray-500"}`,children:[f>0?"+":"",f.toFixed(1),"%"]})})]},a.term)})})]})]})})]})]})]})};var F=a.i(95490);let G=(0,s.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var H=a.i(33508),I=a.i(92e3),J=a.i(14548),K=a.i(69520),L=a.i(5522);let M=()=>{let{addToast:a}=(0,o.useToast)(),{data:d=[]}=(0,e.useStudents)(),{data:g=[]}=(0,e.useClasses)(),{data:h=[]}=(0,e.useScores)(),{data:i=f.INITIAL_SETTINGS}=(0,e.useSettings)(),{mutate:j}=(0,e.useUpdateSettings)(),{mutate:k}=(0,e.useUpdateScore)(),[p,q]=(0,c.useState)(g[0]?.id||""),[r,s]=(0,c.useState)(i.promotion_threshold),[t,u]=(0,c.useState)(new Map),[v,w]=(0,c.useState)(!1),x=g.find(a=>a.id===p),y=g.find((a,b)=>b===g.findIndex(a=>a.id===p)+1),z=d.filter(a=>a.class_id===p),A=(0,c.useMemo)(()=>z.map(a=>{let b=h.filter(b=>b.student_id===a.id&&b.session===i.current_session).map(a=>a.average).filter(a=>a>0),c=b.length>0?b.reduce((a,b)=>a+b,0)/b.length:0,e=f.getStudentPosition(a.id,d,h,i.current_session,i.current_term);return{student:a,average:Math.round(100*c)/100,termsWithScores:b.length,position:e,eligible:c>=r,promotedTo:t.get(a.id)||null}}).sort((a,b)=>b.average-a.average),[z,h,i,r,t]),B=A.filter(a=>a.eligible).length,C=A.filter(a=>null!==a.promotedTo).length;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Promotion Engine"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Manage end-of-session student promotions"})]}),(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"Threshold:"}),(0,b.jsx)(L.Input,{type:"number",value:r,onChange:a=>s(parseInt(a.target.value)||0),min:0,max:100,className:"w-20"}),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"%"}),r!==i.promotion_threshold&&(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",onClick:()=>{j({...i,promotion_threshold:r}),a(`Threshold updated to ${r}%`,"success")},children:[(0,b.jsx)(J.Save,{className:"h-3 w-3 mr-1"}),"Save"]})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-brand-50 to-white",children:(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Total Students"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:A.length})]})}),(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-green-50 to-white",children:(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Eligible for Promotion"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600",children:B})]})}),(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-red-50 to-white",children:(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"To Repeat"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-red-600",children:A.length-B})]})}),(0,b.jsx)(l.Card,{className:"bg-gradient-to-br from-blue-50 to-white",children:(0,b.jsxs)("div",{className:"p-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Processed"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:C})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)(l.Card,{className:"lg:col-span-1",children:(0,b.jsxs)("div",{className:"p-4 space-y-4",children:[(0,b.jsx)(n.Select,{label:"Select Class",value:p,onChange:a=>{q(a.target.value),u(new Map)},children:g.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))}),(0,b.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"From:"}),(0,b.jsx)("span",{className:"font-medium",children:x?.name})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"To:"}),(0,b.jsx)("span",{className:"font-medium text-brand-600",children:y?.name||"N/A (Final Class)"})]})]}),(0,b.jsxs)(m.Button,{className:"w-full",onClick:()=>{if(!y)return void a("No next class available for promotion","warning");w(!0);let b=new Map;A.forEach(a=>{a.eligible?b.set(a.student.id,y.id):b.set(a.student.id,p)}),u(b),w(!1),a(`Processed ${A.length} students`,"success")},disabled:v||!y,children:[(0,b.jsx)(K.RefreshCw,{className:`h-4 w-4 mr-2 ${v?"animate-spin":""}`}),"Run Auto-Promotion"]}),C>0&&(0,b.jsxs)(m.Button,{className:"w-full",variant:"outline",onClick:()=>{let b=0;h.forEach(a=>{let c=t.get(a.student_id);c&&a.session===i.current_session&&a.promoted_to!==c&&(k({id:a.id,updates:{promoted_to:c}}),b++)}),b>0?a(`Promotions saved for ${b} student records`,"success"):a("No changes to save","info")},children:[(0,b.jsx)(J.Save,{className:"h-4 w-4 mr-2"}),"Save Promotions"]})]})}),(0,b.jsx)(l.Card,{className:"lg:col-span-3",children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-700 mb-4",children:["Students in ",x?.name]}),(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left",children:"Student"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Average"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Position"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Status"}),(0,b.jsx)("th",{className:"px-4 py-2 text-center",children:"Action"})]})}),(0,b.jsxs)("tbody",{children:[A.map(a=>{let c=a.promotedTo===y?.id;return(0,b.jsxs)("tr",{className:"border-t",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.student.names}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.student.student_no})]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:(0,b.jsxs)("span",{className:`font-bold ${a.eligible?"text-green-600":"text-red-600"}`,children:[a.average.toFixed(1),"%"]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:a.position?f.ordinalSuffix(a.position):"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:a.promotedTo?(0,b.jsx)("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${c?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.ArrowUp,{className:"h-3 w-3"})," Promoted"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(H.X,{className:"h-3 w-3"})," Repeat"]})}):(0,b.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:a.eligible?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(G,{className:"h-3 w-3"})," Eligible"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(I.AlertCircle,{className:"h-3 w-3"})," Below Threshold"]})})}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:a.promotedTo&&y&&(0,b.jsx)("button",{onClick:()=>(a=>{if(!y)return;let b=t.get(a),c=new Map(t);b===y.id?c.set(a,p):c.set(a,y.id),u(c)})(a.student.id),className:`text-xs px-2 py-1 rounded ${c?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,children:c?"Set to Repeat":"Promote"})})]},a.student.id)}),0===A.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"No students in this class"})})]})]})]})})]})]})};var N=a.i(11300),O=a.i(93518);let P=({student:a,students:d,currentClass:e,scores:g,settings:h})=>{let i=(0,c.useMemo)(()=>g.find(b=>b.student_id===a.id&&b.session===h.current_session&&b.term===h.current_term),[g,a.id,h]),j=(0,c.useMemo)(()=>i?f.getStudentPosition(a.id,d,g,h.current_session,h.current_term):null,[a.id,d,g,h,i]),m=(0,c.useMemo)(()=>d.filter(b=>b.class_id===a.class_id).length,[d,a.class_id]);f.getSubjectsForClass(e);let n=a=>{switch(a){case"A":return"bg-green-100 text-green-700";case"B":return"bg-blue-100 text-blue-700";case"C":return"bg-yellow-100 text-yellow-700";case"D":return"bg-orange-100 text-orange-700";case"E":case"F":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"My Academic Scores"}),(0,b.jsxs)("p",{className:"text-gray-500",children:["View your scores for ",h.current_term," - ",h.current_session]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsx)(l.Card,{className:"p-4 bg-gradient-to-br from-brand-500 to-brand-600 text-white",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,b.jsx)(q.TrendingUp,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-3xl font-bold",children:[i?.average?.toFixed(1)||"0","%"]}),(0,b.jsx)("p",{className:"text-xs text-white/80",children:"Term Average"})]})]})}),(0,b.jsx)(l.Card,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-amber-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(O.Award,{className:"h-5 w-5 text-amber-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:j?f.ordinalSuffix(j):"-"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Class Position"})]})]})}),(0,b.jsx)(l.Card,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(k.BookOpen,{className:"h-5 w-5 text-purple-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:i?.rows?.length||0}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Subjects"})]})]})}),(0,b.jsx)(l.Card,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(N.ClipboardList,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Students in Class"})]})]})})]}),(0,b.jsxs)(l.Card,{className:"p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(N.ClipboardList,{className:"h-5 w-5 text-brand-500"}),"Subject Scores"]}),i&&i.rows.length>0?(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b-2 border-gray-200",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-bold text-gray-700",children:"Subject"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"CA1 (15)"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"CA2 (15)"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Exam (70)"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Total (100)"}),(0,b.jsx)("th",{className:"text-center py-3 px-4 font-bold text-gray-700",children:"Grade"})]})}),(0,b.jsx)("tbody",{children:i.rows.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"py-3 px-4 font-medium text-gray-900",children:a.subject}),(0,b.jsx)("td",{className:"py-3 px-4 text-center text-gray-600",children:a.ca1}),(0,b.jsx)("td",{className:"py-3 px-4 text-center text-gray-600",children:a.ca2}),(0,b.jsx)("td",{className:"py-3 px-4 text-center text-gray-600",children:a.exam}),(0,b.jsx)("td",{className:"py-3 px-4 text-center font-bold text-gray-900",children:a.total}),(0,b.jsx)("td",{className:"py-3 px-4 text-center",children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${n(a.grade)}`,children:a.grade})})]},c))}),(0,b.jsx)("tfoot",{children:(0,b.jsxs)("tr",{className:"bg-gray-50 font-bold",children:[(0,b.jsx)("td",{className:"py-3 px-4 text-gray-900",children:"Overall Average"}),(0,b.jsx)("td",{className:"py-3 px-4 text-center",colSpan:3}),(0,b.jsxs)("td",{className:"py-3 px-4 text-center text-brand-600 text-lg",children:[i.average?.toFixed(1),"%"]}),(0,b.jsx)("td",{className:"py-3 px-4 text-center",children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${n(i.rows[0]?.grade||"C")}`,children:i.average&&i.average>=70?"A":i.average&&i.average>=60?"B":i.average&&i.average>=50?"C":i.average&&i.average>=45?"D":"F"})})]})})]})}):(0,b.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,b.jsx)(N.ClipboardList,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"italic",children:"No scores available for this term yet."}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Check back later for your results."})]})]}),i&&(i.teacher_remark||i.head_teacher_remark)&&(0,b.jsxs)(l.Card,{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Remarks"}),(0,b.jsxs)("div",{className:"space-y-4",children:[i.teacher_remark&&(0,b.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-100",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-blue-600 uppercase mb-1",children:"Class Teacher's Remark"}),(0,b.jsx)("p",{className:"text-gray-700",children:i.teacher_remark})]}),i.head_teacher_remark&&(0,b.jsxs)("div",{className:"p-4 bg-purple-50 rounded-lg border border-purple-100",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-purple-600 uppercase mb-1",children:"Principal's Remark"}),(0,b.jsx)("p",{className:"text-gray-700",children:i.head_teacher_remark})]})]})]})]})};function Q(){let{currentRole:a,currentUser:h}=(0,d.useSchoolStore)(),{data:i=[]}=(0,e.useStudents)(),{data:j=[]}=(0,e.useClasses)(),{data:k=[]}=(0,e.useScores)(),{data:l=f.INITIAL_SETTINGS}=(0,e.useSettings)(),{mutate:m}=(0,e.useCreateScore)(),{mutate:n}=(0,e.useUpdateScore)(),[o,q]=(0,c.useState)("grading"),r="student"===a||"parent"===a,s=(0,c.useMemo)(()=>{if(!r)return null;let a=h?.student_id||i[0]?.id;return i.find(b=>b.id===a)||i[0]},[r,h,i]),t=s?j.find(a=>a.id===s.class_id):void 0;return r&&s?(0,b.jsx)(P,{student:s,students:i,currentClass:t,scores:k,settings:l}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-lg w-fit no-print",children:[(0,b.jsx)("button",{onClick:()=>q("grading"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"grading"===o?"bg-white shadow text-brand-700":"text-gray-600 hover:text-gray-900"}`,children:"Score Entry"}),(0,b.jsx)("button",{onClick:()=>q("comparison"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"comparison"===o?"bg-white shadow text-brand-700":"text-gray-600 hover:text-gray-900"}`,children:"Term Comparison"}),(0,b.jsx)("button",{onClick:()=>q("promotion"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"promotion"===o?"bg-white shadow text-brand-700":"text-gray-600 hover:text-gray-900"}`,children:"Promotions"}),(0,b.jsx)("button",{onClick:()=>q("assignments"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"assignments"===o?"bg-white shadow text-brand-700":"text-gray-600 hover:text-gray-900"}`,children:"Subject Teachers"})]}),"grading"===o&&(0,b.jsx)(g.GradingView,{students:i,classes:j,scores:k,settings:l,onUpsertScore:a=>{k.find(b=>b.id===a.id)?n({id:a.id,updates:a}):m(a)}}),"comparison"===o&&(0,b.jsx)(E,{students:i,classes:j,scores:k,settings:l}),"promotion"===o&&(0,b.jsx)(M,{}),"assignments"===o&&(0,b.jsx)(p,{})]})}a.s(["default",()=>Q],53999)}];

//# sourceMappingURL=app_%28dashboard%29_grading_page_tsx_8f01774b._.js.map